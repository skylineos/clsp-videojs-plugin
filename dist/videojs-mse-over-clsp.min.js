!function(n){var r={};function o(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return n[e].call(t.exports,t,t.exports,o),t.l=!0,t.exports}o.m=n,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(n,r,function(e){return t[e]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}({"./node_modules/debug/src/browser.js":function(o,r,e){(function(t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};r.log=function(){var e;return"object"===("undefined"===typeof console?"undefined":n(console))&&console.log&&(e=console).log.apply(e,arguments)},r.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+o.exports.humanize(this.diff),!this.useColors)return;var t="color: "+this.color;e.splice(1,0,t,"color: inherit");var n=0,r=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(n++,"%c"===e&&(r=n))}),e.splice(r,0,t)},r.save=function(e){try{e?r.storage.setItem("debug",e):r.storage.removeItem("debug")}catch(e){}},r.load=function(){var e=void 0;try{e=r.storage.getItem("debug")}catch(e){}!e&&"undefined"!==typeof t&&"env"in t&&(e=t.env.DEBUG);return e},r.useColors=function(){if("undefined"!==typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!==typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!==typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!==typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},r.storage=function(){try{return localStorage}catch(e){}}(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],o.exports=e("./node_modules/debug/src/common.js")(r),o.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}).call(this,e("./node_modules/node-libs-browser/node_modules/process/browser.js"))},"./node_modules/debug/src/common.js":function(e,t,i){function a(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}e.exports=function(t){function n(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return u.colors[Math.abs(t)%u.colors.length]}function u(e){var a=void 0;function c(){for(var e=arguments.length,o=Array(e),t=0;t<e;t++)o[t]=arguments[t];if(c.enabled){var s=c,n=Number(new Date),r=n-(a||n);s.diff=r,s.prev=a,s.curr=n,a=n,o[0]=u.coerce(o[0]),"string"!==typeof o[0]&&o.unshift("%O");var i=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,function(e,t){if("%%"===e)return e;i++;var n=u.formatters[t];if("function"===typeof n){var r=o[i];e=n.call(s,r),o.splice(i,1),i--}return e}),u.formatArgs.call(s,o),(s.log||u.log).apply(s,o)}}return c.namespace=e,c.enabled=u.enabled(e),c.useColors=u.useColors(),c.color=n(e),c.destroy=r,c.extend=o,"function"===typeof u.init&&u.init(c),u.instances.push(c),c}function r(){var e=u.instances.indexOf(this);return-1!==e&&(u.instances.splice(e,1),!0)}function o(e,t){return u(this.namespace+("undefined"===typeof t?":":t)+e)}function s(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return((u.debug=u).default=u).coerce=function(e){return e instanceof Error?e.stack||e.message:e},u.disable=function(){var e=[].concat(a(u.names.map(s)),a(u.skips.map(s).map(function(e){return"-"+e}))).join(",");return u.enable(""),e},u.enable=function(e){u.save(e),u.names=[],u.skips=[];var t=void 0,n=("string"===typeof e?e:"").split(/[\s,]+/),r=n.length;for(t=0;t<r;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?u.skips.push(new RegExp("^"+e.substr(1)+"$")):u.names.push(new RegExp("^"+e+"$")));for(t=0;t<u.instances.length;t++){var o=u.instances[t];o.enabled=u.enabled(o.namespace)}},u.enabled=function(e){if("*"===e[e.length-1])return!0;var t=void 0,n=void 0;for(t=0,n=u.skips.length;t<n;t++)if(u.skips[t].test(e))return!1;for(t=0,n=u.names.length;t<n;t++)if(u.names[t].test(e))return!0;return!1},u.humanize=i("./node_modules/ms/index.js"),Object.keys(t).forEach(function(e){u[e]=t[e]}),u.instances=[],u.names=[],u.skips=[],u.formatters={},u.selectColor=n,u.enable(u.load()),u}},"./node_modules/lodash/_Symbol.js":function(e,t,n){var r=n("./node_modules/lodash/_root.js").Symbol;e.exports=r},"./node_modules/lodash/_apply.js":function(e,t){e.exports=function(e,t,n){switch(n.length){case 0:return e.call(t);case 1:return e.call(t,n[0]);case 2:return e.call(t,n[0],n[1]);case 3:return e.call(t,n[0],n[1],n[2])}return e.apply(t,n)}},"./node_modules/lodash/_arrayLikeKeys.js":function(e,t,n){var d=n("./node_modules/lodash/_baseTimes.js"),l=n("./node_modules/lodash/isArguments.js"),f=n("./node_modules/lodash/isArray.js"),h=n("./node_modules/lodash/isBuffer.js"),p=n("./node_modules/lodash/_isIndex.js"),m=n("./node_modules/lodash/isTypedArray.js"),g=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=f(e),r=!n&&l(e),o=!n&&!r&&h(e),s=!n&&!r&&!o&&m(e),i=n||r||o||s,a=i?d(e.length,String):[],c=a.length;for(var u in e)!t&&!g.call(e,u)||i&&("length"==u||o&&("offset"==u||"parent"==u)||s&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||p(u,c))||a.push(u);return a}},"./node_modules/lodash/_baseGetTag.js":function(e,t,n){var r=n("./node_modules/lodash/_Symbol.js"),o=n("./node_modules/lodash/_getRawTag.js"),s=n("./node_modules/lodash/_objectToString.js"),i=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":i&&i in Object(e)?o(e):s(e)}},"./node_modules/lodash/_baseIsArguments.js":function(e,t,n){var r=n("./node_modules/lodash/_baseGetTag.js"),o=n("./node_modules/lodash/isObjectLike.js");e.exports=function(e){return o(e)&&"[object Arguments]"==r(e)}},"./node_modules/lodash/_baseIsNative.js":function(e,t,n){var r=n("./node_modules/lodash/isFunction.js"),o=n("./node_modules/lodash/_isMasked.js"),s=n("./node_modules/lodash/isObject.js"),i=n("./node_modules/lodash/_toSource.js"),a=/^\[object .+?Constructor\]$/,c=Function.prototype,u=Object.prototype,d=c.toString,l=u.hasOwnProperty,f=RegExp("^"+d.call(l).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!s(e)||o(e))&&(r(e)?f:a).test(i(e))}},"./node_modules/lodash/_baseIsTypedArray.js":function(e,t,n){var r=n("./node_modules/lodash/_baseGetTag.js"),o=n("./node_modules/lodash/isLength.js"),s=n("./node_modules/lodash/isObjectLike.js"),i={};i["[object Float32Array]"]=i["[object Float64Array]"]=i["[object Int8Array]"]=i["[object Int16Array]"]=i["[object Int32Array]"]=i["[object Uint8Array]"]=i["[object Uint8ClampedArray]"]=i["[object Uint16Array]"]=i["[object Uint32Array]"]=!0,i["[object Arguments]"]=i["[object Array]"]=i["[object ArrayBuffer]"]=i["[object Boolean]"]=i["[object DataView]"]=i["[object Date]"]=i["[object Error]"]=i["[object Function]"]=i["[object Map]"]=i["[object Number]"]=i["[object Object]"]=i["[object RegExp]"]=i["[object Set]"]=i["[object String]"]=i["[object WeakMap]"]=!1,e.exports=function(e){return s(e)&&o(e.length)&&!!i[r(e)]}},"./node_modules/lodash/_baseKeysIn.js":function(e,t,n){var o=n("./node_modules/lodash/isObject.js"),s=n("./node_modules/lodash/_isPrototype.js"),i=n("./node_modules/lodash/_nativeKeysIn.js"),a=Object.prototype.hasOwnProperty;e.exports=function(e){if(!o(e))return i(e);var t=s(e),n=[];for(var r in e)("constructor"!=r||!t&&a.call(e,r))&&n.push(r);return n}},"./node_modules/lodash/_baseRest.js":function(e,t,n){var r=n("./node_modules/lodash/identity.js"),o=n("./node_modules/lodash/_overRest.js"),s=n("./node_modules/lodash/_setToString.js");e.exports=function(e,t){return s(o(e,t,r),e+"")}},"./node_modules/lodash/_baseSetToString.js":function(e,t,n){var r=n("./node_modules/lodash/constant.js"),o=n("./node_modules/lodash/_defineProperty.js"),s=n("./node_modules/lodash/identity.js"),i=o?function(e,t){return o(e,"toString",{configurable:!0,enumerable:!1,value:r(t),writable:!0})}:s;e.exports=i},"./node_modules/lodash/_baseTimes.js":function(e,t){e.exports=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}},"./node_modules/lodash/_baseUnary.js":function(e,t){e.exports=function(t){return function(e){return t(e)}}},"./node_modules/lodash/_coreJsData.js":function(e,t,n){var r=n("./node_modules/lodash/_root.js")["__core-js_shared__"];e.exports=r},"./node_modules/lodash/_defineProperty.js":function(e,t,n){var r=n("./node_modules/lodash/_getNative.js"),o=function(){try{var e=r(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=o},"./node_modules/lodash/_freeGlobal.js":function(r,e,t){(function(e){var t="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n="object"==("undefined"===typeof e?"undefined":t(e))&&e&&e.Object===Object&&e;r.exports=n}).call(this,t("./node_modules/webpack/buildin/global.js"))},"./node_modules/lodash/_getNative.js":function(e,t,n){var r=n("./node_modules/lodash/_baseIsNative.js"),o=n("./node_modules/lodash/_getValue.js");e.exports=function(e,t){var n=o(e,t);return r(n)?n:void 0}},"./node_modules/lodash/_getRawTag.js":function(e,t,n){var r=n("./node_modules/lodash/_Symbol.js"),o=Object.prototype,s=o.hasOwnProperty,i=o.toString,a=r?r.toStringTag:void 0;e.exports=function(e){var t=s.call(e,a),n=e[a];try{var r=!(e[a]=void 0)}catch(e){}var o=i.call(e);return r&&(t?e[a]=n:delete e[a]),o}},"./node_modules/lodash/_getValue.js":function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},"./node_modules/lodash/_isIndex.js":function(e,t){var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var n="undefined"===typeof e?"undefined":r(e);return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&o.test(e))&&e>-1&&e%1==0&&e<t}},"./node_modules/lodash/_isIterateeCall.js":function(e,t,n){var o="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=n("./node_modules/lodash/eq.js"),i=n("./node_modules/lodash/isArrayLike.js"),a=n("./node_modules/lodash/_isIndex.js"),c=n("./node_modules/lodash/isObject.js");e.exports=function(e,t,n){if(!c(n))return!1;var r="undefined"===typeof t?"undefined":o(t);return!!("number"==r?i(n)&&a(t,n.length):"string"==r&&t in n)&&s(n[t],e)}},"./node_modules/lodash/_isMasked.js":function(e,t,n){var r,o=n("./node_modules/lodash/_coreJsData.js"),s=(r=/[^.]+$/.exec(o&&o.keys&&o.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";e.exports=function(e){return!!s&&s in e}},"./node_modules/lodash/_isPrototype.js":function(e,t){var n=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||n)}},"./node_modules/lodash/_nativeKeysIn.js":function(e,t){e.exports=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t}},"./node_modules/lodash/_nodeUtil.js":function(e,a,c){(function(e){var t="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=c("./node_modules/lodash/_freeGlobal.js"),r="object"==t(a)&&a&&!a.nodeType&&a,o=r&&"object"==t(e)&&e&&!e.nodeType&&e,s=o&&o.exports===r&&n.process,i=function(){try{var e=o&&o.require&&o.require("util").types;return e||s&&s.binding&&s.binding("util")}catch(e){}}();e.exports=i}).call(this,c("./node_modules/webpack/buildin/module.js")(e))},"./node_modules/lodash/_objectToString.js":function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},"./node_modules/lodash/_overRest.js":function(e,t,n){var c=n("./node_modules/lodash/_apply.js"),u=Math.max;e.exports=function(s,i,a){return i=u(void 0===i?s.length-1:i,0),function(){for(var e=arguments,t=-1,n=u(e.length-i,0),r=Array(n);++t<n;)r[t]=e[i+t];t=-1;for(var o=Array(i+1);++t<i;)o[t]=e[t];return o[i]=a(r),c(s,this,o)}}},"./node_modules/lodash/_root.js":function(e,t,n){var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n("./node_modules/lodash/_freeGlobal.js"),s="object"==("undefined"===typeof self?"undefined":r(self))&&self&&self.Object===Object&&self,i=o||s||Function("return this")();e.exports=i},"./node_modules/lodash/_setToString.js":function(e,t,n){var r=n("./node_modules/lodash/_baseSetToString.js"),o=n("./node_modules/lodash/_shortOut.js")(r);e.exports=o},"./node_modules/lodash/_shortOut.js":function(e,t){var s=Date.now;e.exports=function(n){var r=0,o=0;return function(){var e=s(),t=16-(e-o);if(o=e,t>0){if(++r>=800)return arguments[0]}else r=0;return n.apply(void 0,arguments)}}},"./node_modules/lodash/_toSource.js":function(e,t){var n=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return n.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},"./node_modules/lodash/constant.js":function(e,t){e.exports=function(e){return function(){return e}}},"./node_modules/lodash/defaults.js":function(e,t,n){var r=n("./node_modules/lodash/_baseRest.js"),l=n("./node_modules/lodash/eq.js"),f=n("./node_modules/lodash/_isIterateeCall.js"),h=n("./node_modules/lodash/keysIn.js"),p=Object.prototype,m=p.hasOwnProperty,o=r(function(e,t){e=Object(e);var n=-1,r=t.length,o=r>2?t[2]:void 0;for(o&&f(t[0],t[1],o)&&(r=1);++n<r;)for(var s=t[n],i=h(s),a=-1,c=i.length;++a<c;){var u=i[a],d=e[u];(void 0===d||l(d,p[u])&&!m.call(e,u))&&(e[u]=s[u])}return e});e.exports=o},"./node_modules/lodash/eq.js":function(e,t){e.exports=function(e,t){return e===t||e!==e&&t!==t}},"./node_modules/lodash/identity.js":function(e,t){e.exports=function(e){return e}},"./node_modules/lodash/isArguments.js":function(e,t,n){var r=n("./node_modules/lodash/_baseIsArguments.js"),o=n("./node_modules/lodash/isObjectLike.js"),s=Object.prototype,i=s.hasOwnProperty,a=s.propertyIsEnumerable,c=r(function(){return arguments}())?r:function(e){return o(e)&&i.call(e,"callee")&&!a.call(e,"callee")};e.exports=c},"./node_modules/lodash/isArray.js":function(e,t){var n=Array.isArray;e.exports=n},"./node_modules/lodash/isArrayLike.js":function(e,t,n){var r=n("./node_modules/lodash/isFunction.js"),o=n("./node_modules/lodash/isLength.js");e.exports=function(e){return null!=e&&o(e.length)&&!r(e)}},"./node_modules/lodash/isBuffer.js":function(e,c,u){(function(e){var t="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=u("./node_modules/lodash/_root.js"),r=u("./node_modules/lodash/stubFalse.js"),o="object"==t(c)&&c&&!c.nodeType&&c,s=o&&"object"==t(e)&&e&&!e.nodeType&&e,i=s&&s.exports===o?n.Buffer:void 0,a=(i?i.isBuffer:void 0)||r;e.exports=a}).call(this,u("./node_modules/webpack/buildin/module.js")(e))},"./node_modules/lodash/isFunction.js":function(e,t,n){var r=n("./node_modules/lodash/_baseGetTag.js"),o=n("./node_modules/lodash/isObject.js");e.exports=function(e){if(!o(e))return!1;var t=r(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},"./node_modules/lodash/isLength.js":function(e,t){e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},"./node_modules/lodash/isObject.js":function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=function(e){var t="undefined"===typeof e?"undefined":n(e);return null!=e&&("object"==t||"function"==t)}},"./node_modules/lodash/isObjectLike.js":function(e,t){var n="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};e.exports=function(e){return null!=e&&"object"==("undefined"===typeof e?"undefined":n(e))}},"./node_modules/lodash/isTypedArray.js":function(e,t,n){var r=n("./node_modules/lodash/_baseIsTypedArray.js"),o=n("./node_modules/lodash/_baseUnary.js"),s=n("./node_modules/lodash/_nodeUtil.js"),i=s&&s.isTypedArray,a=i?o(i):r;e.exports=a},"./node_modules/lodash/keysIn.js":function(e,t,n){var r=n("./node_modules/lodash/_arrayLikeKeys.js"),o=n("./node_modules/lodash/_baseKeysIn.js"),s=n("./node_modules/lodash/isArrayLike.js");e.exports=function(e){return s(e)?r(e,!0):o(e)}},"./node_modules/lodash/noop.js":function(e,t){e.exports=function(){}},"./node_modules/lodash/stubFalse.js":function(e,t){e.exports=function(){return!1}},"./node_modules/ms/index.js":function(e,t){var r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=36e5,s=864e5;function i(e,t,n,r){var o=t>=1.5*n;return Math.round(e/n)+" "+r+(o?"s":"")}e.exports=function(e,t){t=t||{};var n="undefined"===typeof e?"undefined":r(e);if("string"===n&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^((?:\d+)?\-?\d?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"weeks":case"week":case"w":return 6048e5*n;case"days":case"day":case"d":return n*s;case"hours":case"hour":case"hrs":case"hr":case"h":return n*o;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*n;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(e);if("number"===n&&!1===isNaN(e))return t.long?function(e){var t=Math.abs(e);if(t>=s)return i(e,t,s,"day");if(t>=o)return i(e,t,o,"hour");if(t>=6e4)return i(e,t,6e4,"minute");if(t>=1e3)return i(e,t,1e3,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=s)return Math.round(e/s)+"d";if(t>=o)return Math.round(e/o)+"h";if(t>=6e4)return Math.round(e/6e4)+"m";if(t>=1e3)return Math.round(e/1e3)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},"./node_modules/node-libs-browser/node_modules/process/browser.js":function(e,t){var n,r,o=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function a(t){if(n===setTimeout)return setTimeout(t,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}!function(){try{n="function"===typeof setTimeout?setTimeout:s}catch(e){n=s}try{r="function"===typeof clearTimeout?clearTimeout:i}catch(e){r=i}}();var c,u=[],d=!1,l=-1;function f(){d&&c&&(d=!1,c.length?u=c.concat(u):l=-1,u.length&&h())}function h(){if(!d){var e=a(f);d=!0;for(var t=u.length;t;){for(c=u,u=[];++l<t;)c&&c[l].run();l=-1,t=u.length}c=null,d=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===i||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new p(e,t)),1!==u.length||d||a(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=m,o.addListener=m,o.once=m,o.off=m,o.removeListener=m,o.removeAllListeners=m,o.emit=m,o.prependListener=m,o.prependOnceListener=m,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},"./node_modules/srcdoc-polyfill/srcdoc-polyfill.js":function(e,t,n){var r,o,s;"function"===typeof Symbol&&Symbol.iterator;o=this,s=window.srcDoc,void 0===(r=function(e){!function(e,t){var n,r,o,s=!!("srcdoc"in document.createElement("iframe")),i="Polyfill may not function in the presence of the `sandbox` attribute. Consider using the `force` option.",a=/\ballow-same-origin\b/,c=function(e,t){var n=e.getAttribute("sandbox");"string"!==typeof n||a.test(n)||(t&&t.force?e.removeAttribute("sandbox"):t&&!1===t.force||(o(i),e.setAttribute("data-srcdoc-polyfill",i)))},u={compliant:function(e,t,n){t&&(c(e,n),e.setAttribute("srcdoc",t))},legacy:function(e,t,n){var r;e&&e.getAttribute&&(t?e.setAttribute("srcdoc",t):t=e.getAttribute("srcdoc"),t&&(c(e,n),r="javascript: window.frameElement.getAttribute('srcdoc');",e.contentWindow&&(e.contentWindow.location=r),e.setAttribute("src",r)))}},d=e;if(o=window.console&&window.console.error?function(e){window.console.error("[srcdoc-polyfill] "+e)}:function(){},d.set=u.compliant,d.noConflict=function(){return window.srcDoc=t,d},!s)for(d.set=u.legacy,r=document.getElementsByTagName("iframe"),n=r.length;n--;)d.set(r[n])}(e,s),o.srcDoc=e}.apply(t,[t]))||(e.exports=r)},"./node_modules/uuid/lib/bytesToUuid.js":function(e,t){for(var o=[],n=0;n<256;++n)o[n]=(n+256).toString(16).substr(1);e.exports=function(e,t){var n=t||0,r=o;return[r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],"-",r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]],r[e[n++]]].join("")}},"./node_modules/uuid/lib/rng-browser.js":function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var o=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0===(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},"./node_modules/uuid/v4.js":function(e,t,n){var i=n("./node_modules/uuid/lib/rng-browser.js"),a=n("./node_modules/uuid/lib/bytesToUuid.js");e.exports=function(e,t,n){var r=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||i)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var s=0;s<16;++s)t[r+s]=o[s];return t||a(o)}},"./node_modules/webpack/buildin/global.js":function(ul,vl){var xl,wl="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};xl=function(){return this}();try{xl=xl||Function("return this")()||eval("this")}catch(e){"object"===("undefined"===typeof window?"undefined":wl(window))&&(xl=window)}ul.exports=xl},"./node_modules/webpack/buildin/module.js":function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},"./package.json":function(e){e.exports={name:"videojs-mse-over-clsp",version:"0.13.9-2",description:"Uses clsp (iot) as a video distribution system, video is is received via the clsp client then rendered using the media source extensions. ",main:"dist/videojs-mse-over-clsp.js","generator-videojs-plugin":{version:"5.0.0"},scripts:{build:"./scripts/build.sh",serve:"./scripts/serve.sh",lint:"eslint ./ --cache --quiet --ext .jsx --ext .js","lint-fix":"eslint ./ --cache --quiet --ext .jsx --ext .js --fix",preversion:"./scripts/version.sh --pre",version:"./scripts/version.sh",postversion:"./scripts/version.sh --post"},keywords:["videojs","videojs-plugin"],author:"dschere@skylinenet.net",license:"MIT",dependencies:{debug:"^4.1.0",lodash:"^4.17.10","paho-mqtt":"^1.0.4"},devDependencies:{"babel-core":"^6.26.3","babel-eslint":"^8.2.5","babel-loader":"^7.1.5","babel-plugin-transform-class-properties":"^6.24.1","babel-plugin-transform-object-rest-spread":"^6.26.0","babel-polyfill":"^6.26.0","babel-preset-env":"^1.7.0","css-loader":"^1.0.1",eslint:"^5.0.1","extract-text-webpack-plugin":"^4.0.0-beta.0",gulp:"^3.9.1","gulp-load-plugins":"^1.5.0",humanize:"0.0.9",jquery:"^3.3.1","js-string-escape":"^1.0.1",moment:"^2.22.2","node-sass":"^4.10.0","pre-commit":"^1.2.2","run-sequence":"^2.2.0","sass-loader":"^7.0.3","srcdoc-polyfill":"^1.0.0",standard:"^12.0.1","style-loader":"^0.23.1","uglifyjs-webpack-plugin":"^2.0.1","url-loader":"^1.0.1","video.js":"^7.3.0","videojs-errors":"^4.1.1",webpack:"^4.15.1","webpack-serve":"^2.0.2","write-file-webpack-plugin":"^4.3.2"}}},"./src/js/MqttConduitCollection.js":function(e,t,n){"use strict";n.r(t);var r=n("./node_modules/debug/src/browser.js"),o=n.n(r),s=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();var i=void 0,a=function(){function e(){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.debug=o()("skyline:clsp:MqttConduitCollection"),this.debug("constructing..."),this._conduits={},window.addEventListener("message",function(e){n.debug("window on message");var t=e.data.clientId;n.exists(t)?n.getById(t).iov.onMessage(e):"fail"===!e.data.event&&console.error('No conduit with id "'+t+'" exists!')})}return s(e,null,[{key:"factory",value:function(){return i||(i=new e),i}}]),s(e,[{key:"set",value:function(e,t){return this.debug("setting...",e,t),this._conduits[e]=t}},{key:"remove",value:function(e){delete this._conduits[e]}},{key:"addFromIov",value:function(e){this.debug("adding from iov...",e);var t=this.exists(e.config.clientId)?this.getById(e.config.clientId):window.mqttConduit(e);return this.set(e.config.clientId,t)}},{key:"getById",value:function(e){return this.debug("getting...",e),this._conduits[e]}},{key:"exists",value:function(e){return this.debug("exists?",e),this._conduits.hasOwnProperty(e)}}]),e}();t.default=a},"./src/js/MqttHandler.js":function(e,t,n){"use strict";n.r(t);var r=n("./node_modules/debug/src/browser.js"),i=n.n(r),o=n("video.js"),s=n.n(o),a=n("./src/js/iov/IOV.js"),c=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();var u=s.a.getComponent("Component"),d=function(e){function s(e,t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);var o=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,t,r.mqtt));return o.debug=i()("skyline:clsp:MqttHandler"),o.debug("constructor"),o.tech_=t,o.source_=e,o.iov=null,o.mqttConduitCollection=n,o}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(s,u),c(s,[{key:"createIOV",value:function(e){this.debug("createIOV"),this.updateIOV(a.default.fromUrl(this.source_.src,this.mqttConduitCollection,e)),this.iov.initialize()}},{key:"updateIOV",value:function(e){if(this.debug("updateIOV"),this.iov){if(this.iov.id===e.id)return;this.iov.destroy()}this.iov=e}}]),s}();t.default=d},"./src/js/MqttSourceHandler.js":function(e,t,n){"use strict";n.r(t);var r=n("./node_modules/debug/src/browser.js"),o=n.n(r),s=n("video.js"),a=n.n(s),c=n("./src/js/MqttHandler.js"),u=n("./src/js/utils.js");t.default=function(){var i=o()("skyline:clsp:MqttSourceHandler");return function(o,s){var t={canHandleSource:function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i("canHandleSource"),e.src?e.src.startsWith("clsp")?u.default.supported()?t.canPlayType(e.type):(i("Browser not supported. Chrome 52+ is required."),!1):(console.error("srcObj.src is not clsp protocol"),!1):(console.error("srcObj doesn't contain src"),i(e),!1)},handleSource:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};i("handleSource");var r=a.a.mergeOptions(a.a.options,n,{mqtt:{mode:o}});return t.mqtt=new c.default(e,t,s,r),t.mqtt},canPlayType:function(e){return i("canPlayType"),"video/mp4; codecs='avc1.42E01E'"===e?"maybe":(console.error("clsp type='"+e+"' rejected"),"")}};return t}}},"./src/js/MseOverMqttPlugin.js":function(e,t,n){"use strict";n.r(t);var r=n("./node_modules/debug/src/browser.js"),d=n.n(r),o=n("video.js"),l=n.n(o),s=n("./src/js/MqttSourceHandler.js"),i=n("./src/js/MqttConduitCollection.js"),f=n("./src/js/utils.js"),h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}var m=l.a.getPlugin("plugin");t.default=function(){var e,t,u=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t=e=function(e){function c(o,e){var s=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,c);var i=p(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,o,e));i.onMqttHandlerError=function(){i.player.tech(!0).mqtt.destroy(),i.player.error({code:0,type:"INSUFFICIENT_RESOURCES",headline:"Insufficient Resources",message:"The current hardware cannot support the current number of playing streams."})},i.debug=d()("skyline:clsp:plugin:ClspPlugin"),i.debug("constructing...");var t,n,r,a=o.options_;return i.options=l.a.mergeOptions(h({},i.constructor.getDefaultOptions(),u,a.clsp||{}),e),i._playerOptions=a,i.currentSourceIndex=0,o.addClass("vjs-mse-over-mqtt"),i.options.customClass&&o.addClass(i.options.customClass),i.resetErrors(o),f.default.supported()?(i.autoplayEnabled=a.autoplay||"true"===o.getAttribute("autoplay"),o._errorRetriesCount=0,o._currentTime=0,o.currentTime=function(){return o._currentTime++},o.on("ready",function(){i.autoplayEnabled&&setTimeout(function(){o.play()})}),o.on("error",(n=regeneratorRuntime.mark(function e(t){var n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=o.error(),e.t0=n.code,e.next=0===e.t0?4:4===e.t0?4:5===e.t0?4:"PLAYER_ERR_IOV"===e.t0?4:5;break;case 4:return e.abrupt("break",17);case 5:if(0===i.options.maxRetriesOnError)return e.abrupt("break",17);e.next=7;break;case 7:if(!(i.options.maxRetriesOnError<0||o._errorRetriesCount<=i.options.maxRetriesOnError)){e.next=17;break}if(o._errorRetriesCount++,i.resetErrors(o),(r=o.tech(!0).mqtt.iov)&&!r.destroyed&&r.player){e.next=15;break}i.initializeIOV(o),e.next=17;break;case 15:return e.next=17,r.player.restart();case 17:case"end":return e.stop()}},e,s)}),r=function(){var a=n.apply(this,arguments);return new Promise(function(s,i){return function t(e,n){try{var r=a[e](n),o=r.value}catch(e){return void i(e)}if(!r.done)return Promise.resolve(o).then(function(e){t("next",e)},function(e){t("throw",e)});s(o)}("next")})},function(e){return r.apply(this,arguments)})),o.on("firstplay",function(e){i.debug("on player firstplay"),i.initializeIOV(o)}),o.on("dispose",function(){try{o.tech(!0).mqtt.iov.destroy()}catch(e){console.error("Error while destroying clsp plugin instance!"),console.error(e)}}),i):(t=o.error({code:"PLAYER_ERR_NOT_COMPAT",type:"PLAYER_ERR_NOT_COMPAT",dismiss:!1}),p(i,t))}return function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(c,m),a(c,null,[{key:"register",value:function(){if(l.a.getPlugin(f.default.name))throw new Error("You can only register the clsp plugin once, and it has already been registered.");return l.a.getTech("Html5").registerSourceHandler(Object(s.default)()("html5",i.default.factory()),0),l.a.registerPlugin(f.default.name,c),c}},{key:"getDefaultOptions",value:function(){return{maxRetriesOnError:-1,tourDuration:1e4,enableMetrics:!1,videojsErrorsOptions:{}}}}]),a(c,[{key:"getVideojsErrorsOptions",value:function(){return h({timeout:12e4,errors:{PLAYER_ERR_NOT_COMPAT:{type:"PLAYER_ERR_NOT_COMPAT",headline:"This browser is unsupported.",message:"Chrome 52+ is required."}}},this.options.videojsErrorsOptions)}},{key:"resetErrors",value:function(e){e.error(null),e.errorDisplay.close(),e.errors&&e.errors(this.getVideojsErrorsOptions())}},{key:"initializeIOV",value:function(e){var t=e.tech(!0).mqtt;if(!t)throw new Error("VideoJS Player "+e.id()+" does not have mqtt tech!");t.off("error",this.onMqttHandlerError),t.on("error",this.onMqttHandlerError),t.createIOV(e,{enableMetrics:this.options.enableMetrics,defaultNonSslPort:this.options.defaultNonSslPort,defaultSslPort:this.options.defaultSslPort})}},{key:"destroy",value:function(){this.debug("destroying..."),this.player.tech(!0).mqtt.off("error",this.onMqttHandlerError),this._playerOptions=null,this.currentSourceIndex=null,this.debug=null}}]),c}(),e.VERSION=f.default.version,e.utils=f.default,e.METRIC_TYPES=["videojs.errorRetriesCount"],t}},"./src/js/conduit/clspConduit.generated.js":function(e,t){window.mqttConduit=function(e){var t=document.createElement("iframe"),n=e.config.useSSL?"true":"false",r="<html><head><script>\nvar MqttIp = '"+e.config.wsbroker+"' ; \nvar MqttPort = "+e.config.wsport+"; \nvar MqttUseSSL = "+n+"; \nvar MqttClientId = '"+e.config.clientId+"' ; \nvar Origin = '"+window.location.origin+'\' ; \n/*******************************************************************************\n * Copyright (c) 2013, 2016 IBM Corp.\n *\n * All rights reserved. This program and the accompanying materials\n * are made available under the terms of the Eclipse Public License v1.0\n * and Eclipse Distribution License v1.0 which accompany this distribution.\n *\n * The Eclipse Public License is available at\n *    http://www.eclipse.org/legal/epl-v10.html\n * and the Eclipse Distribution License is available at\n *   http://www.eclipse.org/org/documents/edl-v10.php.\n *\n *******************************************************************************/\n(function(p,s){"object"===typeof exports&&"object"===typeof module?module.exports=s():"function"===typeof define&&define.amd?define(s):"object"===typeof exports?exports=s():("undefined"===typeof p.Paho&&(p.Paho={}),p.Paho.MQTT=s())})(this,function(){return function(p){function s(a,b,c){b[c++]=a>>8;b[c++]=a%256;return c}function u(a,b,c,k){k=s(b,c,k);D(a,c,k);return k+b}function n(a){for(var b=0,c=0;c<a.length;c++){var k=a.charCodeAt(c);2047<k?(55296<=k&&56319>=k&&(c++,b++),b+=3):127<k?b+=2:b++}return b}\nfunction D(a,b,c){for(var k=0;k<a.length;k++){var e=a.charCodeAt(k);if(55296<=e&&56319>=e){var g=a.charCodeAt(++k);if(isNaN(g))throw Error(f(h.MALFORMED_UNICODE,[e,g]));e=(e-55296<<10)+(g-56320)+65536}127>=e?b[c++]=e:(2047>=e?b[c++]=e>>6&31|192:(65535>=e?b[c++]=e>>12&15|224:(b[c++]=e>>18&7|240,b[c++]=e>>12&63|128),b[c++]=e>>6&63|128),b[c++]=e&63|128)}return b}function E(a,b,c){for(var k="",e,g=b;g<b+c;){e=a[g++];if(!(128>e)){var m=a[g++]-128;if(0>m)throw Error(f(h.MALFORMED_UTF,[e.toString(16),m.toString(16),\n""]));if(224>e)e=64*(e-192)+m;else{var d=a[g++]-128;if(0>d)throw Error(f(h.MALFORMED_UTF,[e.toString(16),m.toString(16),d.toString(16)]));if(240>e)e=4096*(e-224)+64*m+d;else{var l=a[g++]-128;if(0>l)throw Error(f(h.MALFORMED_UTF,[e.toString(16),m.toString(16),d.toString(16),l.toString(16)]));if(248>e)e=262144*(e-240)+4096*m+64*d+l;else throw Error(f(h.MALFORMED_UTF,[e.toString(16),m.toString(16),d.toString(16),l.toString(16)]));}}}65535<e&&(e-=65536,k+=String.fromCharCode(55296+(e>>10)),e=56320+(e&\n1023));k+=String.fromCharCode(e)}return k}var z=function(a,b){for(var c in a)if(a.hasOwnProperty(c))if(b.hasOwnProperty(c)){if(typeof a[c]!==b[c])throw Error(f(h.INVALID_TYPE,[typeof a[c],c]));}else{c="Unknown property, "+c+". Valid properties are:";for(var k in b)b.hasOwnProperty(k)&&(c=c+" "+k);throw Error(c);}},v=function(a,b){return function(){return a.apply(b,arguments)}},h={OK:{code:0,text:"AMQJSC0000I OK."},CONNECT_TIMEOUT:{code:1,text:"AMQJSC0001E Connect timed out."},SUBSCRIBE_TIMEOUT:{code:2,\ntext:"AMQJS0002E Subscribe timed out."},UNSUBSCRIBE_TIMEOUT:{code:3,text:"AMQJS0003E Unsubscribe timed out."},PING_TIMEOUT:{code:4,text:"AMQJS0004E Ping timed out."},INTERNAL_ERROR:{code:5,text:"AMQJS0005E Internal error. Error Message: {0}, Stack trace: {1}"},CONNACK_RETURNCODE:{code:6,text:"AMQJS0006E Bad Connack return code:{0} {1}."},SOCKET_ERROR:{code:7,text:"AMQJS0007E Socket error:{0}."},SOCKET_CLOSE:{code:8,text:"AMQJS0008I Socket closed."},MALFORMED_UTF:{code:9,text:"AMQJS0009E Malformed UTF data:{0} {1} {2}."},\nUNSUPPORTED:{code:10,text:"AMQJS0010E {0} is not supported by this browser."},INVALID_STATE:{code:11,text:"AMQJS0011E Invalid state {0}."},INVALID_TYPE:{code:12,text:"AMQJS0012E Invalid type {0} for {1}."},INVALID_ARGUMENT:{code:13,text:"AMQJS0013E Invalid argument {0} for {1}."},UNSUPPORTED_OPERATION:{code:14,text:"AMQJS0014E Unsupported operation."},INVALID_STORED_DATA:{code:15,text:"AMQJS0015E Invalid data in local storage key\\x3d{0} value\\x3d{1}."},INVALID_MQTT_MESSAGE_TYPE:{code:16,text:"AMQJS0016E Invalid MQTT message type {0}."},\nMALFORMED_UNICODE:{code:17,text:"AMQJS0017E Malformed Unicode string:{0} {1}."},BUFFER_FULL:{code:18,text:"AMQJS0018E Message buffer is full, maximum buffer size: {0}."}},H={0:"Connection Accepted",1:"Connection Refused: unacceptable protocol version",2:"Connection Refused: identifier rejected",3:"Connection Refused: server unavailable",4:"Connection Refused: bad user name or password",5:"Connection Refused: not authorized"},f=function(a,b){var c=a.text;if(b)for(var k,e,g=0;g<b.length;g++)if(k="{"+\ng+"}",e=c.indexOf(k),0<e)var h=c.substring(0,e),c=c.substring(e+k.length),c=h+b[g]+c;return c},A=[0,6,77,81,73,115,100,112,3],B=[0,4,77,81,84,84,4],q=function(a,b){this.type=a;for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c])};q.prototype.encode=function(){var a=(this.type&15)<<4,b=0,c=[],k=0,e;void 0!==this.messageIdentifier&&(b+=2);switch(this.type){case 1:switch(this.mqttVersion){case 3:b+=A.length+3;break;case 4:b+=B.length+3}b+=n(this.clientId)+2;void 0!==this.willMessage&&(b+=n(this.willMessage.destinationName)+\n2,e=this.willMessage.payloadBytes,e instanceof Uint8Array||(e=new Uint8Array(h)),b+=e.byteLength+2);void 0!==this.userName&&(b+=n(this.userName)+2);void 0!==this.password&&(b+=n(this.password)+2);break;case 8:for(var a=a|2,g=0;g<this.topics.length;g++)c[g]=n(this.topics[g]),b+=c[g]+2;b+=this.requestedQos.length;break;case 10:a|=2;for(g=0;g<this.topics.length;g++)c[g]=n(this.topics[g]),b+=c[g]+2;break;case 6:a|=2;break;case 3:this.payloadMessage.duplicate&&(a|=8);a=a|=this.payloadMessage.qos<<1;this.payloadMessage.retained&&\n(a|=1);var k=n(this.payloadMessage.destinationName),h=this.payloadMessage.payloadBytes,b=b+(k+2)+h.byteLength;h instanceof ArrayBuffer?h=new Uint8Array(h):h instanceof Uint8Array||(h=new Uint8Array(h.buffer))}var f=b,g=Array(1),d=0;do{var t=f%128,f=f>>7;0<f&&(t|=128);g[d++]=t}while(0<f&&4>d);f=g.length+1;b=new ArrayBuffer(b+f);d=new Uint8Array(b);d[0]=a;d.set(g,1);if(3==this.type)f=u(this.payloadMessage.destinationName,k,d,f);else if(1==this.type){switch(this.mqttVersion){case 3:d.set(A,f);f+=A.length;\nbreak;case 4:d.set(B,f),f+=B.length}a=0;this.cleanSession&&(a=2);void 0!==this.willMessage&&(a=a|4|this.willMessage.qos<<3,this.willMessage.retained&&(a|=32));void 0!==this.userName&&(a|=128);void 0!==this.password&&(a|=64);d[f++]=a;f=s(this.keepAliveInterval,d,f)}void 0!==this.messageIdentifier&&(f=s(this.messageIdentifier,d,f));switch(this.type){case 1:f=u(this.clientId,n(this.clientId),d,f);void 0!==this.willMessage&&(f=u(this.willMessage.destinationName,n(this.willMessage.destinationName),d,f),\nf=s(e.byteLength,d,f),d.set(e,f),f+=e.byteLength);void 0!==this.userName&&(f=u(this.userName,n(this.userName),d,f));void 0!==this.password&&u(this.password,n(this.password),d,f);break;case 3:d.set(h,f);break;case 8:for(g=0;g<this.topics.length;g++)f=u(this.topics[g],c[g],d,f),d[f++]=this.requestedQos[g];break;case 10:for(g=0;g<this.topics.length;g++)f=u(this.topics[g],c[g],d,f)}return b};var F=function(a,b,c){this._client=a;this._window=b;this._keepAliveInterval=1E3*c;this.isReset=!1;var k=(new q(12)).encode(),\ne=function(a){return function(){return g.apply(a)}},g=function(){this.isReset?(this.isReset=!1,this._client._trace("Pinger.doPing","send PINGREQ"),this._client.socket.send(k),this.timeout=this._window.setTimeout(e(this),this._keepAliveInterval)):(this._client._trace("Pinger.doPing","Timed out"),this._client._disconnected(h.PING_TIMEOUT.code,f(h.PING_TIMEOUT)))};this.reset=function(){this.isReset=!0;this._window.clearTimeout(this.timeout);0<this._keepAliveInterval&&(this.timeout=setTimeout(e(this),\nthis._keepAliveInterval))};this.cancel=function(){this._window.clearTimeout(this.timeout)}},w=function(a,b,c,f,e){this._window=b;c||(c=30);this.timeout=setTimeout(function(a,b,c){return function(){return a.apply(b,c)}}(f,a,e),1E3*c);this.cancel=function(){this._window.clearTimeout(this.timeout)}},d=function(a,b,c,d,e){if(!("WebSocket"in p&&null!==p.WebSocket))throw Error(f(h.UNSUPPORTED,["WebSocket"]));if(!("localStorage"in p&&null!==p.localStorage))throw Error(f(h.UNSUPPORTED,["localStorage"]));\nif(!("ArrayBuffer"in p&&null!==p.ArrayBuffer))throw Error(f(h.UNSUPPORTED,["ArrayBuffer"]));this._trace("Paho.MQTT.Client",a,b,c,d,e);this.host=b;this.port=c;this.path=d;this.uri=a;this.clientId=e;this._wsuri=null;this._localKey=b+":"+c+("/mqtt"!=d?":"+d:"")+":"+e+":";this._msg_queue=[];this._buffered_msg_queue=[];this._sentMessages={};this._receivedMessages={};this._notify_msg_sent={};this._message_identifier=1;this._sequence=0;for(var g in localStorage)0!==g.indexOf("Sent:"+this._localKey)&&0!==\ng.indexOf("Received:"+this._localKey)||this.restore(g)};d.prototype.host=null;d.prototype.port=null;d.prototype.path=null;d.prototype.uri=null;d.prototype.clientId=null;d.prototype.socket=null;d.prototype.connected=!1;d.prototype.maxMessageIdentifier=65536;d.prototype.connectOptions=null;d.prototype.hostIndex=null;d.prototype.onConnected=null;d.prototype.onConnectionLost=null;d.prototype.onMessageDelivered=null;d.prototype.onMessageArrived=null;d.prototype.traceFunction=null;d.prototype._msg_queue=\nnull;d.prototype._buffered_msg_queue=null;d.prototype._connectTimeout=null;d.prototype.sendPinger=null;d.prototype.receivePinger=null;d.prototype._reconnectInterval=1;d.prototype._reconnecting=!1;d.prototype._reconnectTimeout=null;d.prototype.disconnectedPublishing=!1;d.prototype.disconnectedBufferSize=5E3;d.prototype.receiveBuffer=null;d.prototype._traceBuffer=null;d.prototype._MAX_TRACE_ENTRIES=100;d.prototype.connect=function(a){var b=this._traceMask(a,"password");this._trace("Client.connect",\nb,this.socket,this.connected);if(this.connected)throw Error(f(h.INVALID_STATE,["already connected"]));if(this.socket)throw Error(f(h.INVALID_STATE,["already connected"]));this._reconnecting&&(this._reconnectTimeout.cancel(),this._reconnectTimeout=null,this._reconnecting=!1);this.connectOptions=a;this._reconnectInterval=1;this._reconnecting=!1;a.uris?(this.hostIndex=0,this._doConnect(a.uris[0])):this._doConnect(this.uri)};d.prototype.subscribe=function(a,b){this._trace("Client.subscribe",a,b);if(!this.connected)throw Error(f(h.INVALID_STATE,\n["not connected"]));var c=new q(8);c.topics=[a];c.requestedQos=void 0!==b.qos?[b.qos]:[0];b.onSuccess&&(c.onSuccess=function(a){b.onSuccess({invocationContext:b.invocationContext,grantedQos:a})});b.onFailure&&(c.onFailure=function(a){b.onFailure({invocationContext:b.invocationContext,errorCode:a,errorMessage:f(a)})});b.timeout&&(c.timeOut=new w(this,window,b.timeout,b.onFailure,[{invocationContext:b.invocationContext,errorCode:h.SUBSCRIBE_TIMEOUT.code,errorMessage:f(h.SUBSCRIBE_TIMEOUT)}]));this._requires_ack(c);\nthis._schedule_message(c)};d.prototype.unsubscribe=function(a,b){this._trace("Client.unsubscribe",a,b);if(!this.connected)throw Error(f(h.INVALID_STATE,["not connected"]));var c=new q(10);c.topics=[a];b.onSuccess&&(c.callback=function(){b.onSuccess({invocationContext:b.invocationContext})});b.timeout&&(c.timeOut=new w(this,window,b.timeout,b.onFailure,[{invocationContext:b.invocationContext,errorCode:h.UNSUBSCRIBE_TIMEOUT.code,errorMessage:f(h.UNSUBSCRIBE_TIMEOUT)}]));this._requires_ack(c);this._schedule_message(c)};\nd.prototype.send=function(a){this._trace("Client.send",a);wireMessage=new q(3);wireMessage.payloadMessage=a;if(this.connected)0<a.qos?this._requires_ack(wireMessage):this.onMessageDelivered&&(this._notify_msg_sent[wireMessage]=this.onMessageDelivered(wireMessage.payloadMessage)),this._schedule_message(wireMessage);else if(this._reconnecting&&this.disconnectedPublishing){if(Object.keys(this._sentMessages).length+this._buffered_msg_queue.length>this.disconnectedBufferSize)throw Error(f(h.BUFFER_FULL,\n[this.disconnectedBufferSize]));0<a.qos?this._requires_ack(wireMessage):(wireMessage.sequence=++this._sequence,this._buffered_msg_queue.push(wireMessage))}else throw Error(f(h.INVALID_STATE,["not connected"]));};d.prototype.disconnect=function(){this._trace("Client.disconnect");this._reconnecting&&(this._reconnectTimeout.cancel(),this._reconnectTimeout=null,this._reconnecting=!1);if(!this.socket)throw Error(f(h.INVALID_STATE,["not connecting or connected"]));wireMessage=new q(14);this._notify_msg_sent[wireMessage]=\nv(this._disconnected,this);this._schedule_message(wireMessage)};d.prototype.getTraceLog=function(){if(null!==this._traceBuffer){this._trace("Client.getTraceLog",new Date);this._trace("Client.getTraceLog in flight messages",this._sentMessages.length);for(var a in this._sentMessages)this._trace("_sentMessages ",a,this._sentMessages[a]);for(a in this._receivedMessages)this._trace("_receivedMessages ",a,this._receivedMessages[a]);return this._traceBuffer}};d.prototype.startTrace=function(){null===this._traceBuffer&&\n(this._traceBuffer=[]);this._trace("Client.startTrace",new Date,"1.0.3")};d.prototype.stopTrace=function(){delete this._traceBuffer};d.prototype._doConnect=function(a){this.connectOptions.useSSL&&(a=a.split(":"),a[0]="wss",a=a.join(":"));this._wsuri=a;this.connected=!1;this.socket=4>this.connectOptions.mqttVersion?new WebSocket(a,["mqttv3.1"]):new WebSocket(a,["mqtt"]);this.socket.binaryType="arraybuffer";this.socket.onopen=v(this._on_socket_open,this);this.socket.onmessage=v(this._on_socket_message,\nthis);this.socket.onerror=v(this._on_socket_error,this);this.socket.onclose=v(this._on_socket_close,this);this.sendPinger=new F(this,window,this.connectOptions.keepAliveInterval);this.receivePinger=new F(this,window,this.connectOptions.keepAliveInterval);this._connectTimeout&&(this._connectTimeout.cancel(),this._connectTimeout=null);this._connectTimeout=new w(this,window,this.connectOptions.timeout,this._disconnected,[h.CONNECT_TIMEOUT.code,f(h.CONNECT_TIMEOUT)])};d.prototype._schedule_message=function(a){this._msg_queue.push(a);\nthis.connected&&this._process_queue()};d.prototype.store=function(a,b){var c={type:b.type,messageIdentifier:b.messageIdentifier,version:1};switch(b.type){case 3:b.pubRecReceived&&(c.pubRecReceived=!0);c.payloadMessage={};for(var d="",e=b.payloadMessage.payloadBytes,g=0;g<e.length;g++)d=15>=e[g]?d+"0"+e[g].toString(16):d+e[g].toString(16);c.payloadMessage.payloadHex=d;c.payloadMessage.qos=b.payloadMessage.qos;c.payloadMessage.destinationName=b.payloadMessage.destinationName;b.payloadMessage.duplicate&&\n(c.payloadMessage.duplicate=!0);b.payloadMessage.retained&&(c.payloadMessage.retained=!0);0===a.indexOf("Sent:")&&(void 0===b.sequence&&(b.sequence=++this._sequence),c.sequence=b.sequence);break;default:throw Error(f(h.INVALID_STORED_DATA,[key,c]));}localStorage.setItem(a+this._localKey+b.messageIdentifier,JSON.stringify(c))};d.prototype.restore=function(a){var b=localStorage.getItem(a),c=JSON.parse(b),d=new q(c.type,c);switch(c.type){case 3:for(var b=c.payloadMessage.payloadHex,e=new ArrayBuffer(b.length/\n2),e=new Uint8Array(e),g=0;2<=b.length;){var m=parseInt(b.substring(0,2),16),b=b.substring(2,b.length);e[g++]=m}b=new Paho.MQTT.Message(e);b.qos=c.payloadMessage.qos;b.destinationName=c.payloadMessage.destinationName;c.payloadMessage.duplicate&&(b.duplicate=!0);c.payloadMessage.retained&&(b.retained=!0);d.payloadMessage=b;break;default:throw Error(f(h.INVALID_STORED_DATA,[a,b]));}0===a.indexOf("Sent:"+this._localKey)?(d.payloadMessage.duplicate=!0,this._sentMessages[d.messageIdentifier]=d):0===a.indexOf("Received:"+\nthis._localKey)&&(this._receivedMessages[d.messageIdentifier]=d)};d.prototype._process_queue=function(){for(var a=null,b=this._msg_queue.reverse();a=b.pop();)this._socket_send(a),this._notify_msg_sent[a]&&(this._notify_msg_sent[a](),delete this._notify_msg_sent[a])};d.prototype._requires_ack=function(a){var b=Object.keys(this._sentMessages).length;if(b>this.maxMessageIdentifier)throw Error("Too many messages:"+b);for(;void 0!==this._sentMessages[this._message_identifier];)this._message_identifier++;\na.messageIdentifier=this._message_identifier;this._sentMessages[a.messageIdentifier]=a;3===a.type&&this.store("Sent:",a);this._message_identifier===this.maxMessageIdentifier&&(this._message_identifier=1)};d.prototype._on_socket_open=function(){var a=new q(1,this.connectOptions);a.clientId=this.clientId;this._socket_send(a)};d.prototype._on_socket_message=function(a){this._trace("Client._on_socket_message",a.data);a=this._deframeMessages(a.data);for(var b=0;b<a.length;b+=1)this._handleMessage(a[b])};\nd.prototype._deframeMessages=function(a){a=new Uint8Array(a);var b=[];if(this.receiveBuffer){var c=new Uint8Array(this.receiveBuffer.length+a.length);c.set(this.receiveBuffer);c.set(a,this.receiveBuffer.length);a=c;delete this.receiveBuffer}try{for(c=0;c<a.length;){var d;a:{var e=a,g=c,m=g,n=e[g],l=n>>4,t=n&15,g=g+1,x=void 0,C=0,p=1;do{if(g==e.length){d=[null,m];break a}x=e[g++];C+=(x&127)*p;p*=128}while(0!==(x&128));x=g+C;if(x>e.length)d=[null,m];else{var y=new q(l);switch(l){case 2:e[g++]&1&&(y.sessionPresent=\n!0);y.returnCode=e[g++];break;case 3:var m=t>>1&3,s=256*e[g]+e[g+1],g=g+2,u=E(e,g,s),g=g+s;0<m&&(y.messageIdentifier=256*e[g]+e[g+1],g+=2);var r=new Paho.MQTT.Message(e.subarray(g,x));1==(t&1)&&(r.retained=!0);8==(t&8)&&(r.duplicate=!0);r.qos=m;r.destinationName=u;y.payloadMessage=r;break;case 4:case 5:case 6:case 7:case 11:y.messageIdentifier=256*e[g]+e[g+1];break;case 9:y.messageIdentifier=256*e[g]+e[g+1],g+=2,y.returnCode=e.subarray(g,x)}d=[y,x]}}var v=d[0],c=d[1];if(null!==v)b.push(v);else break}c<\na.length&&(this.receiveBuffer=a.subarray(c))}catch(w){d="undefined"==w.hasOwnProperty("stack")?w.stack.toString():"No Error Stack Available";this._disconnected(h.INTERNAL_ERROR.code,f(h.INTERNAL_ERROR,[w.message,d]));return}return b};d.prototype._handleMessage=function(a){this._trace("Client._handleMessage",a);try{switch(a.type){case 2:this._connectTimeout.cancel();this._reconnectTimeout&&this._reconnectTimeout.cancel();if(this.connectOptions.cleanSession){for(var b in this._sentMessages){var c=this._sentMessages[b];\nlocalStorage.removeItem("Sent:"+this._localKey+c.messageIdentifier)}this._sentMessages={};for(b in this._receivedMessages){var d=this._receivedMessages[b];localStorage.removeItem("Received:"+this._localKey+d.messageIdentifier)}this._receivedMessages={}}if(0===a.returnCode)this.connected=!0,this.connectOptions.uris&&(this.hostIndex=this.connectOptions.uris.length);else{this._disconnected(h.CONNACK_RETURNCODE.code,f(h.CONNACK_RETURNCODE,[a.returnCode,H[a.returnCode]]));break}a=[];for(var e in this._sentMessages)this._sentMessages.hasOwnProperty(e)&&\na.push(this._sentMessages[e]);if(0<this._buffered_msg_queue.length){e=null;for(var g=this._buffered_msg_queue.reverse();e=g.pop();)a.push(e),this.onMessageDelivered&&(this._notify_msg_sent[e]=this.onMessageDelivered(e.payloadMessage))}a=a.sort(function(a,b){return a.sequence-b.sequence});for(var g=0,m=a.length;g<m;g++)if(c=a[g],3==c.type&&c.pubRecReceived){var n=new q(6,{messageIdentifier:c.messageIdentifier});this._schedule_message(n)}else this._schedule_message(c);if(this.connectOptions.onSuccess)this.connectOptions.onSuccess({invocationContext:this.connectOptions.invocationContext});\nc=!1;this._reconnecting&&(c=!0,this._reconnectInterval=1,this._reconnecting=!1);this._connected(c,this._wsuri);this._process_queue();break;case 3:this._receivePublish(a);break;case 4:if(c=this._sentMessages[a.messageIdentifier])if(delete this._sentMessages[a.messageIdentifier],localStorage.removeItem("Sent:"+this._localKey+a.messageIdentifier),this.onMessageDelivered)this.onMessageDelivered(c.payloadMessage);break;case 5:if(c=this._sentMessages[a.messageIdentifier])c.pubRecReceived=!0,n=new q(6,{messageIdentifier:a.messageIdentifier}),\nthis.store("Sent:",c),this._schedule_message(n);break;case 6:d=this._receivedMessages[a.messageIdentifier];localStorage.removeItem("Received:"+this._localKey+a.messageIdentifier);d&&(this._receiveMessage(d),delete this._receivedMessages[a.messageIdentifier]);var l=new q(7,{messageIdentifier:a.messageIdentifier});this._schedule_message(l);break;case 7:c=this._sentMessages[a.messageIdentifier];delete this._sentMessages[a.messageIdentifier];localStorage.removeItem("Sent:"+this._localKey+a.messageIdentifier);\nif(this.onMessageDelivered)this.onMessageDelivered(c.payloadMessage);break;case 9:if(c=this._sentMessages[a.messageIdentifier]){c.timeOut&&c.timeOut.cancel();if(128===a.returnCode[0]){if(c.onFailure)c.onFailure(a.returnCode)}else if(c.onSuccess)c.onSuccess(a.returnCode);delete this._sentMessages[a.messageIdentifier]}break;case 11:if(c=this._sentMessages[a.messageIdentifier])c.timeOut&&c.timeOut.cancel(),c.callback&&c.callback(),delete this._sentMessages[a.messageIdentifier];break;case 13:this.sendPinger.reset();\nbreak;case 14:this._disconnected(h.INVALID_MQTT_MESSAGE_TYPE.code,f(h.INVALID_MQTT_MESSAGE_TYPE,[a.type]));break;default:this._disconnected(h.INVALID_MQTT_MESSAGE_TYPE.code,f(h.INVALID_MQTT_MESSAGE_TYPE,[a.type]))}}catch(t){c="undefined"==t.hasOwnProperty("stack")?t.stack.toString():"No Error Stack Available",this._disconnected(h.INTERNAL_ERROR.code,f(h.INTERNAL_ERROR,[t.message,c]))}};d.prototype._on_socket_error=function(a){this._reconnecting||this._disconnected(h.SOCKET_ERROR.code,f(h.SOCKET_ERROR,\n[a.data]))};d.prototype._on_socket_close=function(){this._reconnecting||this._disconnected(h.SOCKET_CLOSE.code,f(h.SOCKET_CLOSE))};d.prototype._socket_send=function(a){if(1==a.type){var b=this._traceMask(a,"password");this._trace("Client._socket_send",b)}else this._trace("Client._socket_send",a);this.socket.send(a.encode());this.sendPinger.reset()};d.prototype._receivePublish=function(a){switch(a.payloadMessage.qos){case "undefined":case 0:this._receiveMessage(a);break;case 1:var b=new q(4,{messageIdentifier:a.messageIdentifier});\nthis._schedule_message(b);this._receiveMessage(a);break;case 2:this._receivedMessages[a.messageIdentifier]=a;this.store("Received:",a);a=new q(5,{messageIdentifier:a.messageIdentifier});this._schedule_message(a);break;default:throw Error("Invaild qos\\x3d"+wireMmessage.payloadMessage.qos);}};d.prototype._receiveMessage=function(a){if(this.onMessageArrived)this.onMessageArrived(a.payloadMessage)};d.prototype._connected=function(a,b){if(this.onConnected)this.onConnected(a,b)};d.prototype._reconnect=\nfunction(){this._trace("Client._reconnect");this.connected||(this._reconnecting=!0,this.sendPinger.cancel(),this.receivePinger.cancel(),128>this._reconnectInterval&&(this._reconnectInterval*=2),this.connectOptions.uris?(this.hostIndex=0,this._doConnect(this.connectOptions.uris[0])):this._doConnect(this.uri))};d.prototype._disconnected=function(a,b){this._trace("Client._disconnected",a,b);if(void 0!==a&&this._reconnecting)this._reconnectTimeout=new w(this,window,this._reconnectInterval,this._reconnect);\nelse if(this.sendPinger.cancel(),this.receivePinger.cancel(),this._connectTimeout&&(this._connectTimeout.cancel(),this._connectTimeout=null),this._msg_queue=[],this._buffered_msg_queue=[],this._notify_msg_sent={},this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,1===this.socket.readyState&&this.socket.close(),delete this.socket),this.connectOptions.uris&&this.hostIndex<this.connectOptions.uris.length-1)this.hostIndex++,this._doConnect(this.connectOptions.uris[this.hostIndex]);\nelse if(void 0===a&&(a=h.OK.code,b=f(h.OK)),this.connected){this.connected=!1;if(this.onConnectionLost)this.onConnectionLost({errorCode:a,errorMessage:b,reconnect:this.connectOptions.reconnect,uri:this._wsuri});a!==h.OK.code&&this.connectOptions.reconnect&&(this._reconnectInterval=1,this._reconnect())}else if(4===this.connectOptions.mqttVersion&&!1===this.connectOptions.mqttVersionExplicit)this._trace("Failed to connect V4, dropping back to V3"),this.connectOptions.mqttVersion=3,this.connectOptions.uris?\n(this.hostIndex=0,this._doConnect(this.connectOptions.uris[0])):this._doConnect(this.uri);else if(this.connectOptions.onFailure)this.connectOptions.onFailure({invocationContext:this.connectOptions.invocationContext,errorCode:a,errorMessage:b})};d.prototype._trace=function(){if(this.traceFunction){for(var a in arguments)"undefined"!==typeof arguments[a]&&arguments.splice(a,1,JSON.stringify(arguments[a]));a=Array.prototype.slice.call(arguments).join("");this.traceFunction({severity:"Debug",message:a})}if(null!==\nthis._traceBuffer){a=0;for(var b=arguments.length;a<b;a++)this._traceBuffer.length==this._MAX_TRACE_ENTRIES&&this._traceBuffer.shift(),0===a?this._traceBuffer.push(arguments[a]):"undefined"===typeof arguments[a]?this._traceBuffer.push(arguments[a]):this._traceBuffer.push("  "+JSON.stringify(arguments[a]))}};d.prototype._traceMask=function(a,b){var c={},d;for(d in a)a.hasOwnProperty(d)&&(c[d]=d==b?"******":a[d]);return c};var G=function(a,b,c,k){var e;if("string"!==typeof a)throw Error(f(h.INVALID_TYPE,\n[typeof a,"host"]));if(2==arguments.length){k=b;e=a;var g=e.match(/^(wss?):\\/\\/((\\[(.+)\\])|([^\\/]+?))(:(\\d+))?(\\/.*)$/);if(g)a=g[4]||g[2],b=parseInt(g[7]),c=g[8];else throw Error(f(h.INVALID_ARGUMENT,[a,"host"]));}else{3==arguments.length&&(k=c,c="/mqtt");if("number"!==typeof b||0>b)throw Error(f(h.INVALID_TYPE,[typeof b,"port"]));if("string"!==typeof c)throw Error(f(h.INVALID_TYPE,[typeof c,"path"]));e="ws://"+(-1!==a.indexOf(":")&&"["!==a.slice(0,1)&&"]"!==a.slice(-1)?"["+a+"]":a)+":"+b+c}for(var m=\ng=0;m<k.length;m++){var n=k.charCodeAt(m);55296<=n&&56319>=n&&m++;g++}if("string"!==typeof k||65535<g)throw Error(f(h.INVALID_ARGUMENT,[k,"clientId"]));var l=new d(e,a,b,c,k);this._getHost=function(){return a};this._setHost=function(){throw Error(f(h.UNSUPPORTED_OPERATION));};this._getPort=function(){return b};this._setPort=function(){throw Error(f(h.UNSUPPORTED_OPERATION));};this._getPath=function(){return c};this._setPath=function(){throw Error(f(h.UNSUPPORTED_OPERATION));};this._getURI=function(){return e};\nthis._setURI=function(){throw Error(f(h.UNSUPPORTED_OPERATION));};this._getClientId=function(){return l.clientId};this._setClientId=function(){throw Error(f(h.UNSUPPORTED_OPERATION));};this._getOnConnected=function(){return l.onConnected};this._setOnConnected=function(a){if("function"===typeof a)l.onConnected=a;else throw Error(f(h.INVALID_TYPE,[typeof a,"onConnected"]));};this._getDisconnectedPublishing=function(){return l.disconnectedPublishing};this._setDisconnectedPublishing=function(a){l.disconnectedPublishing=\na};this._getDisconnectedBufferSize=function(){return l.disconnectedBufferSize};this._setDisconnectedBufferSize=function(a){l.disconnectedBufferSize=a};this._getOnConnectionLost=function(){return l.onConnectionLost};this._setOnConnectionLost=function(a){if("function"===typeof a)l.onConnectionLost=a;else throw Error(f(h.INVALID_TYPE,[typeof a,"onConnectionLost"]));};this._getOnMessageDelivered=function(){return l.onMessageDelivered};this._setOnMessageDelivered=function(a){if("function"===typeof a)l.onMessageDelivered=\na;else throw Error(f(h.INVALID_TYPE,[typeof a,"onMessageDelivered"]));};this._getOnMessageArrived=function(){return l.onMessageArrived};this._setOnMessageArrived=function(a){if("function"===typeof a)l.onMessageArrived=a;else throw Error(f(h.INVALID_TYPE,[typeof a,"onMessageArrived"]));};this._getTrace=function(){return l.traceFunction};this._setTrace=function(a){if("function"===typeof a)l.traceFunction=a;else throw Error(f(h.INVALID_TYPE,[typeof a,"onTrace"]));};this.connect=function(a){a=a||{};z(a,\n{timeout:"number",userName:"string",password:"string",willMessage:"object",keepAliveInterval:"number",cleanSession:"boolean",useSSL:"boolean",invocationContext:"object",onSuccess:"function",onFailure:"function",hosts:"object",ports:"object",reconnect:"boolean",mqttVersion:"number",mqttVersionExplicit:"boolean",uris:"object"});void 0===a.keepAliveInterval&&(a.keepAliveInterval=60);if(4<a.mqttVersion||3>a.mqttVersion)throw Error(f(h.INVALID_ARGUMENT,[a.mqttVersion,"connectOptions.mqttVersion"]));void 0===\na.mqttVersion?(a.mqttVersionExplicit=!1,a.mqttVersion=4):a.mqttVersionExplicit=!0;if(void 0!==a.password&&void 0===a.userName)throw Error(f(h.INVALID_ARGUMENT,[a.password,"connectOptions.password"]));if(a.willMessage){if(!(a.willMessage instanceof r))throw Error(f(h.INVALID_TYPE,[a.willMessage,"connectOptions.willMessage"]));a.willMessage.stringPayload=null;if("undefined"===typeof a.willMessage.destinationName)throw Error(f(h.INVALID_TYPE,[typeof a.willMessage.destinationName,"connectOptions.willMessage.destinationName"]));\n}"undefined"===typeof a.cleanSession&&(a.cleanSession=!0);if(a.hosts){if(!(a.hosts instanceof Array))throw Error(f(h.INVALID_ARGUMENT,[a.hosts,"connectOptions.hosts"]));if(1>a.hosts.length)throw Error(f(h.INVALID_ARGUMENT,[a.hosts,"connectOptions.hosts"]));for(var b=!1,d=0;d<a.hosts.length;d++){if("string"!==typeof a.hosts[d])throw Error(f(h.INVALID_TYPE,[typeof a.hosts[d],"connectOptions.hosts["+d+"]"]));if(/^(wss?):\\/\\/((\\[(.+)\\])|([^\\/]+?))(:(\\d+))?(\\/.*)$/.test(a.hosts[d]))if(0===d)b=!0;else{if(!b)throw Error(f(h.INVALID_ARGUMENT,\n[a.hosts[d],"connectOptions.hosts["+d+"]"]));}else if(b)throw Error(f(h.INVALID_ARGUMENT,[a.hosts[d],"connectOptions.hosts["+d+"]"]));}if(b)a.uris=a.hosts;else{if(!a.ports)throw Error(f(h.INVALID_ARGUMENT,[a.ports,"connectOptions.ports"]));if(!(a.ports instanceof Array))throw Error(f(h.INVALID_ARGUMENT,[a.ports,"connectOptions.ports"]));if(a.hosts.length!==a.ports.length)throw Error(f(h.INVALID_ARGUMENT,[a.ports,"connectOptions.ports"]));a.uris=[];for(d=0;d<a.hosts.length;d++){if("number"!==typeof a.ports[d]||\n0>a.ports[d])throw Error(f(h.INVALID_TYPE,[typeof a.ports[d],"connectOptions.ports["+d+"]"]));var b=a.hosts[d],g=a.ports[d];e="ws://"+(-1!==b.indexOf(":")?"["+b+"]":b)+":"+g+c;a.uris.push(e)}}}l.connect(a)};this.subscribe=function(a,b){if("string"!==typeof a)throw Error("Invalid argument:"+a);b=b||{};z(b,{qos:"number",invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"});if(b.timeout&&!b.onFailure)throw Error("subscribeOptions.timeout specified with no onFailure callback.");\nif("undefined"!==typeof b.qos&&0!==b.qos&&1!==b.qos&&2!==b.qos)throw Error(f(h.INVALID_ARGUMENT,[b.qos,"subscribeOptions.qos"]));l.subscribe(a,b)};this.unsubscribe=function(a,b){if("string"!==typeof a)throw Error("Invalid argument:"+a);b=b||{};z(b,{invocationContext:"object",onSuccess:"function",onFailure:"function",timeout:"number"});if(b.timeout&&!b.onFailure)throw Error("unsubscribeOptions.timeout specified with no onFailure callback.");l.unsubscribe(a,b)};this.send=function(a,b,c,d){var e;if(0===\narguments.length)throw Error("Invalid argument.length");if(1==arguments.length){if(!(a instanceof r)&&"string"!==typeof a)throw Error("Invalid argument:"+typeof a);e=a;if("undefined"===typeof e.destinationName)throw Error(f(h.INVALID_ARGUMENT,[e.destinationName,"Message.destinationName"]));}else e=new r(b),e.destinationName=a,3<=arguments.length&&(e.qos=c),4<=arguments.length&&(e.retained=d);l.send(e)};this.publish=function(a,b,c,d){console.log("Publising message to: ",a);var e;if(0===arguments.length)throw Error("Invalid argument.length");\nif(1==arguments.length){if(!(a instanceof r)&&"string"!==typeof a)throw Error("Invalid argument:"+typeof a);e=a;if("undefined"===typeof e.destinationName)throw Error(f(h.INVALID_ARGUMENT,[e.destinationName,"Message.destinationName"]));}else e=new r(b),e.destinationName=a,3<=arguments.length&&(e.qos=c),4<=arguments.length&&(e.retained=d);l.send(e)};this.disconnect=function(){l.disconnect()};this.getTraceLog=function(){return l.getTraceLog()};this.startTrace=function(){l.startTrace()};this.stopTrace=\nfunction(){l.stopTrace()};this.isConnected=function(){return l.connected}};G.prototype={get host(){return this._getHost()},set host(a){this._setHost(a)},get port(){return this._getPort()},set port(a){this._setPort(a)},get path(){return this._getPath()},set path(a){this._setPath(a)},get clientId(){return this._getClientId()},set clientId(a){this._setClientId(a)},get onConnected(){return this._getOnConnected()},set onConnected(a){this._setOnConnected(a)},get disconnectedPublishing(){return this._getDisconnectedPublishing()},\nset disconnectedPublishing(a){this._setDisconnectedPublishing(a)},get disconnectedBufferSize(){return this._getDisconnectedBufferSize()},set disconnectedBufferSize(a){this._setDisconnectedBufferSize(a)},get onConnectionLost(){return this._getOnConnectionLost()},set onConnectionLost(a){this._setOnConnectionLost(a)},get onMessageDelivered(){return this._getOnMessageDelivered()},set onMessageDelivered(a){this._setOnMessageDelivered(a)},get onMessageArrived(){return this._getOnMessageArrived()},set onMessageArrived(a){this._setOnMessageArrived(a)},\nget trace(){return this._getTrace()},set trace(a){this._setTrace(a)}};var r=function(a){var b;if("string"===typeof a||a instanceof ArrayBuffer||a instanceof Int8Array||a instanceof Uint8Array||a instanceof Int16Array||a instanceof Uint16Array||a instanceof Int32Array||a instanceof Uint32Array||a instanceof Float32Array||a instanceof Float64Array)b=a;else throw f(h.INVALID_ARGUMENT,[a,"newPayload"]);this._getPayloadString=function(){return"string"===typeof b?b:E(b,0,b.length)};this._getPayloadBytes=\nfunction(){if("string"===typeof b){var a=new ArrayBuffer(n(b)),a=new Uint8Array(a);D(b,a,0);return a}return b};var c;this._getDestinationName=function(){return c};this._setDestinationName=function(a){if("string"===typeof a)c=a;else throw Error(f(h.INVALID_ARGUMENT,[a,"newDestinationName"]));};var d=0;this._getQos=function(){return d};this._setQos=function(a){if(0===a||1===a||2===a)d=a;else throw Error("Invalid argument:"+a);};var e=!1;this._getRetained=function(){return e};this._setRetained=function(a){if("boolean"===\ntypeof a)e=a;else throw Error(f(h.INVALID_ARGUMENT,[a,"newRetained"]));};var g=!1;this._getDuplicate=function(){return g};this._setDuplicate=function(a){g=a}};r.prototype={get payloadString(){return this._getPayloadString()},get payloadBytes(){return this._getPayloadBytes()},get destinationName(){return this._getDestinationName()},set destinationName(a){this._setDestinationName(a)},get topic(){return this._getDestinationName()},set topic(a){this._setDestinationName(a)},get qos(){return this._getQos()},\nset qos(a){this._setQos(a)},get retained(){return this._getRetained()},set retained(a){this._setRetained(a)},get duplicate(){return this._getDuplicate()},set duplicate(a){this._setDuplicate(a)}};return{Client:G,Message:r}}(window)});\nfunction _clspRouter() {\n    function send(m){\n        // route message to parent which will in turn route to the correct\n        // player based on clientId.\n        m.clientId = MqttClientId;\n        window.parent.postMessage(m,"*");\n    }// end send\n\n\n    function routeInbound(message){\n        var pstring = "";\n\n        try {\n            pstring = message.payloadString;\n        } catch(e) {\n            //bogus excepton?\n        }\n\n        send({\n          event: \'data\',\n          destinationName: message.destinationName,\n          payloadString: pstring,\n          payloadBytes: message.payloadBytes || null\n        });\n    }// end route inbound\n\n    function disconnect () {\n        var ERROR_CODE_NOT_CONNECTED = \'AMQJS0011E\';\n\n        try {\n            MQTTClient.disconnect();\n        } catch (e) {\n            if (!e.message.startsWith(ERROR_CODE_NOT_CONNECTED)) {\n                console.error(e);\n            }\n        }\n    }\n\n    function eventHandler(evt){\n        var m = evt.data;\n\n        try {\n            if (m.method === \'subscribe\') {\n                MQTTClient.subscribe(m.topic);\n            } else if (m.method === \'unsubscribe\') {\n                MQTTClient.unsubscribe(m.topic);\n            } else if (m.method === \'publish\') {\n                var mqtt_payload = null;\n                try {\n                    mqtt_payload = JSON.stringify(m.data);\n                } catch( json_error ) {\n                    console.error("json stringify error: " + m.data);\n                    return;\n                }\n\n                var mqtt_msg = new Paho.MQTT.Message(mqtt_payload);\n                mqtt_msg.destinationName = m.topic;\n                MQTTClient.send(mqtt_msg);\n            } else if (m.method === \'connect\') {\n                connect();\n            } else if (m.method === \'disconnect\') {\n                disconnect();\n            }\n        } catch(e) {\n            // we are dead!\n           send({\n               event: \'fail\',\n               reason: "network failure"\n            });\n\n            disconnect();\n        }\n\n    }\n\n    function AppReady() {\n        window.removeEventListener("message", eventHandler);\n        window.addEventListener("message", eventHandler, false);\n\n        send({\n          event: \'ready\'\n        });\n\n        if (Reconnect !== -1)\n        {\n            clearInterval(Reconnect);\n            Reconnect = -1;\n        }\n\n    }// application ready\n\n\n    function AppFail(message) {\n      var e = "Error code " +\n          parseInt(message.errorCode) + ": " + message.errorMessage;\n      send({\n        event: \'fail\',\n        reason: e\n      });\n    }\n\n    MQTTClient = new Paho.MQTT.Client(\n        MqttIp,\n        MqttPort,\n        MqttClientId\n    );\n\n    /*\n     * Hold the id of the reconnect interval task\n     */\n    var Reconnect = -1;\n\n    /*\n     * Callback which gets called when the connection is lost\n     */\n    function onConnectionLost(message){\n        if (message.errorCode === 0) {\n            return;\n        }\n\n        send({\n            event: \'fail\',\n            reason: "connection lost error code " + parseInt(message.errorCode)\n        });\n        if (Reconnect === -1) {\n            Reconnect = setInterval(function () {\n                connect();\n            }, 2000);\n        }\n    }\n\n    MQTTClient.onConnectionLost = onConnectionLost;\n\n    // perhaps the busiest function in this module ;)\n    MQTTClient.onMessageArrived = function(message) {\n        try {\n             routeInbound(message);\n        }catch(e) {\n            if (e) {\n                console.error(e);\n            }\n        }\n    };\n\n    /**\n     * Connect to MQTT...\n     */\n    function connect()\n    {\n        // setup connection options\n        var options = {\n            timeout: 120,\n            onSuccess:  AppReady,\n            onFailure: AppFail\n        };\n        // last will message sent on disconnect\n        var willmsg = new Paho.MQTT.Message(JSON.stringify({\n            clientId: MqttClientId\n        }));\n        willmsg.destinationName = "iov/clientDisconnect";\n        options.willMessage = willmsg;\n\n        if (MqttUseSSL === true) {\n            options.useSSL = true;\n        }\n\n        try {\n            MQTTClient.connect(options);\n        } catch(e) {\n            var ERROR_CODE_ALREADY_CONNECTED = \'AMQJS0011E\';\n\n            if (!e.message.startsWith(ERROR_CODE_ALREADY_CONNECTED)) {\n                console.error("connect failed", e);\n                send({\n                    event: \'fail\',\n                    reason: "connect failed"\n                });\n            }\n        }\n    }\n\n    connect();\n}\n\nfunction clspRouter() {\n    try {\n        _clspRouter();\n    } catch(e) {\n        console.error("IFRAME error");\n        console.error(e);\n    }\n}\n\nfunction onunload()\n{\n    if (typeof MQTTClient !== \'undefined\') {\n        try {\n            MQTTClient.disconnect();\n        } catch (e) {\n            if (!e.message.startsWith(\'AMQJS0011E\')) {\n                console.error(e);\n            }\n        }\n    }\n}\n\n<\/script>\n</head><body onload="clspRouter();" onunload="onunload();"><body><div id="message"></div></body></html>';if(t.srcdoc=r,t.width=0,t.height=0,t.setAttribute("style","display:none;"),t.setAttribute("id",e.config.clientId),null!==e.config.videoElementParent)e.config.videoElementParent.appendChild(t);else if(null!==e.videoElement.parentNode)e.videoElement.parentNode.appendChild(t),e.config.videoElementParent=e.videoElement.parentNode;else var o=setInterval(function(){null!==e.videoElement.parentNode&&(e.videoElement.parentNode.appendChild(t),e.config.videoElementParent=e.videoElement.parentNode,clearInterval(o))},1e3);return function(n,t){var o={dispatch:{},iov:t};function r(e){if(null===n.contentWindow)var t=setInterval(function(){null!==n.contentWindow&&(n.contentWindow.postMessage(e,"*"),clearInterval(t))},1e3);else n.contentWindow.postMessage(e,"*")}return o.inboundHandler=function(e){var t=o.dispatch[e.destinationName];if("undefined"!==typeof t)try{t(e)}catch(e){console.error(e)}else console.error("No handler for "+e.destinationName)},o.subscribe=function(e,t){o.dispatch[e]=t,r({method:"subscribe",topic:e})},o.unsubscribe=function(e){e in o.dispatch&&delete o.dispatch[e],r({method:"unsubscribe",topic:e})},o.publish=function(e,t){r({method:"publish",topic:e,data:t})},o.connect=function(){r({method:"connect"})},o.disconnect=function(){r({method:"disconnect"})},o.transaction=function(e,n,r){r.resp_topic=t.config.clientId+"/response/"+parseInt(1e6*Math.random()),o.subscribe(r.resp_topic,function(e){var t=JSON.parse(e.payloadString);n(t),o.unsubscribe(r.resp_topic)}),o.publish(e,r)},o}(t,e)}},"./src/js/iov/IOV.js":function(e,t,n){"use strict";n.r(t);var r=n("./node_modules/debug/src/browser.js"),s=n.n(r),o=n("./node_modules/uuid/v4.js"),i=n.n(o),a=n("./src/js/iov/MqttTopicHandlers.js"),c=n("./src/js/iov/player.js"),u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},d=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();var l=function(){function o(e,t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),o.compatibilityCheck(),this.id=i()(),this.debug=s()("skyline:clsp:iov:"+this.id+":main"),this.debug("constructor"),this.destroyed=!1,this.onReadyAlreadyCalled=!1,this.playerInstance=t,this.videoElement=this.playerInstance.el(),this.config={clientId:this.id,wsbroker:n.wsbroker,wsport:n.wsport,useSSL:n.useSSL,streamName:n.streamName,appStart:n.appStart,videoElementParent:n.videoElementParent||null,changeSourceMaxWait:n.changeSourceMaxWait||o.CHANGE_SOURCE_MAX_WAIT},this.statsMsg={byteCount:0,inkbps:0,host:document.location.host,clientId:this.config.clientId},this.mqttConduitCollection=e,this.mqttTopicHandlers=new a.default(this.id,this),this.events={connection_lost:function(e){console.error("MQTT connection lost"),console.error(e)},on_message:this.mqttTopicHandlers.msghandler,exception:function(e,t){console.error(e),"undefined"!==typeof t&&console.error(t.stack)}}}return d(o,null,[{key:"compatibilityCheck",value:function(){var e=!1;window.MediaSource=window.MediaSource||window.WebKitMediaSource,window.MediaSource||(!1===e&&window.alert("Media Source Extensions not supported in your browser: Claris Live Streaming will not work!"),e=!0)}},{key:"generateConfigFromUrl",value:function(e){if(!e)throw new Error("No source was given to be parsed!");var t=document.createElement("a"),n=void 0,r=void 0;if("clsps"===e.substring(0,5).toLowerCase())n=!0,t.href=e.replace("clsps","https"),r=443;else{if("clsp"!==e.substring(0,4).toLowerCase())throw new Error("The given source is not a clsp url, and therefore cannot be parsed.");n=!1,t.href=e.replace("clsp","http"),r=9001}var o=t.pathname.split("/"),s=o[o.length-1],i=t.hostname,a=t.port;return 0===a.length&&(a=r),"@"===i&&(i=window.location.hostname),{wsbroker:i,wsport:parseInt(a),streamName:s,useSSL:n}}},{key:"factory",value:function(e,t){return new o(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}},{key:"fromUrl",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return o.factory(t,n,u({},r,o.generateConfigFromUrl(e)))}}]),d(o,[{key:"initialize",value:function(){this.conduit=this.mqttConduitCollection.addFromIov(this),this.player=c.default.factory(this,this.playerInstance)}},{key:"clone",value:function(e){this.debug("clone");var t=u({},e,{videoElementParent:this.config.videoElementParent});return o.factory(this.mqttConduitCollection,this.playerInstance,t)}},{key:"cloneFromUrl",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.debug("cloneFromUrl"),this.clone(u({},o.generateConfigFromUrl(e),t))}},{key:"getAvailableStreams",value:function(e){this.debug("getAvailableStreams"),this.conduit.transaction("iov/video/list",e,{})}},{key:"onChangeSource",value:function(e){if(this.debug('changeSource on player "'+this.id+'""'),!e)throw new Error("Unable to change source because there is no url!");var t=this.cloneFromUrl(e);t.initialize(),setTimeout(function(){t.playerInstance.tech(!0).mqtt.updateIOV(t)},t.config.changeSourceMaxWait),t.player.on("firstFrameShown",function(){t.playerInstance.tech(!0).mqtt.updateIOV(t)})}},{key:"onReady",value:function(e){var r=this;this.debug("onReady"),null!==this.videoElement.parentNode&&(this.config.videoElementParentId=this.videoElement.parentNode.id);var t,n,o=this.playerInstance.children()[0];(null!==o.getAttribute("autoplay")&&this.playerInstance.trigger("play",o),this.onReadyAlreadyCalled)?console.warn("tried to use this player more than once..."):(this.onReadyAlreadyCalled=!0,this.player.on("firstFrameShown",function(){r.playerInstance.loadingSpinner.hide(),o.style.display="none"}),this.player.on("videoReceived",function(){r.playerInstance.trigger("timeupdate")}),this.player.on("videoInfoReceived",function(){r.playerInstance.trigger("timeupdate")}),this.playerInstanceEventListeners={changesrc:function(e,t){var n=t.url;return r.onChangeSource(n)}},this.playerInstance.on("changesrc",this.playerInstanceEventListeners.changesrc),document.hidden||this.player.play(),this.videoElement.addEventListener("mse-error-event",(t=regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.player.restart();case 2:case"end":return e.stop()}},e,r)}),n=function(){var a=t.apply(this,arguments);return new Promise(function(s,i){return function t(e,n){try{var r=a[e](n),o=r.value}catch(e){return void i(e)}if(!r.done)return Promise.resolve(o).then(function(e){t("next",e)},function(e){t("throw",e)});s(o)}("next")})},function(e){return n.apply(this,arguments)}),!1),this._statsTimer=setInterval(function(){r.statsMsg.inkbps=8*r.statsMsg.byteCount/3e4,r.statsMsg.byteCount=0,r.conduit.publish("iov/stats",r.statsMsg),r.debug("iov status",r.statsMsg)},5e3))}},{key:"onFail",value:function(e){this.debug("onFail"),clearInterval(this._statsTimer),this.debug("network error",e.data.reason),this.playerInstance.trigger("network-error",e.data.reason)}},{key:"onData",value:function(e){this.debug("onData"),this.conduit.inboundHandler(e.data)}},{key:"onMessage",value:function(e){var t=e.data.event;switch(this.debug("onMessage",t),t){case"ready":this.onReady(e);break;case"fail":this.onFail(e);break;case"data":this.onData(e);break;default:console.error("No match for event: "+t)}}},{key:"destroy",value:function(){if(this.debug("destroy"),!this.destroyed){this.destroyed=!0,clearInterval(this._statsTimer),this.playerInstanceEventListeners&&this.playerInstance.off("changesrc",this.playerInstanceEventListeners.changesrc),this.player.destroy(),this.playerInstance=null,this.player=null,this.mqttConduitCollection.remove(this.id);var e=document.getElementById(this.config.clientId);e.parentNode.removeChild(e),e.srcdoc=""}}}]),o}();l.CHANGE_SOURCE_MAX_WAIT=5e3,t.default=l},"./src/js/iov/MSEWrapper.js":function(e,t,n){"use strict";n.r(t);var r=n("./node_modules/debug/src/browser.js"),o=n.n(r),s=n("./node_modules/lodash/defaults.js"),i=n.n(s),a=n("./node_modules/lodash/noop.js"),c=n.n(a),u=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();var d="skyline:clsp:iov",l=o()(d+":MSEWrapper"),f=o()("silly:"+d+":MSEWrapper"),h=function(){function o(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),this.onSourceBufferUpdateEnd=function(){f("onUpdateEnd"),t.metric("sourceBuffer.updateEnd",1),t.shouldAbort&&t.sourceBufferAbort();try{if(t.sourceBuffer.buffered.length<=0)return t.metric("sourceBuffer.updateEnd.bufferLength.empty",1),void l("After updating, the sourceBuffer has no length!")}catch(e){return t.metric("sourceBuffer.updateEnd.bufferLength.error",1),void l("The mediaSource was removed while an update operation was occurring.")}var e=t.getBufferTimes();t.timeBuffered=e.currentBufferSize,null!==e.previousBufferSize&&e.previousBufferSize>t.timeBuffered?t.onRemoveFinish(e):t.onAppendFinish(e),t.processNextInQueue()},l("Constructing..."),!e)throw new Error("videoElement is required to construct an MSEWrapper.");this.destroyed=!1,this.videoElement=e,this.options=i()({},n,{bufferSizeLimit:90+Math.floor(200*Math.random()),bufferTruncateFactor:2,bufferTruncateValue:null,driftThreshold:2e3,duration:10,enableMetrics:!1}),this.segmentQueue=[],this.sequenceNumber=0,this.mediaSource=null,this.sourceBuffer=null,this.objectURL=null,this.timeBuffered=null,this.options.bufferTruncateValue||(this.options.bufferTruncateValue=parseInt(this.options.bufferSizeLimit/this.options.bufferTruncateFactor)),this.metrics={},this.events={};for(var r=0;r<o.EVENT_NAMES.length;r++)this.events[o.EVENT_NAMES[r]]=[];this.eventListeners={mediaSource:{},sourceBuffer:{}}}var e,t;return u(o,null,[{key:"isMimeCodecSupported",value:function(e){return window.MediaSource&&window.MediaSource.isTypeSupported(e)}},{key:"factory",value:function(e){return new o(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{})}}]),u(o,[{key:"on",value:function(e,t){if(l("Registering Listener for "+e+" event..."),!o.EVENT_NAMES.includes(e))throw new Error('"'+e+'" is not a valid event."');this.events[e].push(t)}},{key:"trigger",value:function(e,t){if("metric"===e?f("Triggering "+e+" event..."):l("Triggering "+e+" event..."),!o.EVENT_NAMES.includes(e))throw new Error('"'+e+'" is not a valid event."');for(var n=0;n<this.events[e].length;n++)this.events[e][n](t,this)}},{key:"metric",value:function(e,t){if(this.options&&this.options.enableMetrics&&o.METRIC_TYPES.includes(e)){switch(e){case"sourceBuffer.lastKnownBufferSize":case"sourceBuffer.lastMoofSize":this.metrics[e]=t;break;default:this.metrics.hasOwnProperty(e)||(this.metrics[e]=0),this.metrics[e]+=t}this.trigger("metric",{type:e,value:this.metrics[e]})}}},{key:"initializeMediaSource",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};l("Initializing mediaSource..."),t=i()({},t,{onSourceOpen:c.a,onSourceEnded:c.a,onError:c.a}),this.metric("mediaSource.created",1),this.destroyMediaSource(),this.mediaSource=new window.MediaSource,this.eventListeners.mediaSource.sourceopen=function(){e.mediaSource.duration=e.options.duration,t.onSourceOpen()},this.eventListeners.mediaSource.sourceended=t.onSourceEnded,this.eventListeners.mediaSource.error=t.onError,this.mediaSource.addEventListener("sourceopen",this.eventListeners.mediaSource.sourceopen),this.mediaSource.addEventListener("sourceended",this.eventListeners.mediaSource.sourceended),this.mediaSource.addEventListener("error",this.eventListeners.mediaSource.error)}},{key:"getVideoElementSrc",value:function(){l("getVideoElementSrc..."),this.mediaSource&&(this.objectURL||(this.metric("objectURL.created",1),this.objectURL=window.URL.createObjectURL(this.mediaSource)),this.videoElement.src=this.objectURL)}},{key:"destroyVideoElementSrc",value:function(){if(l("destroyVideoElementSrc..."),this.mediaSource&&this.objectURL)return this.objectURL=null,this.sourceBuffer&&(this.shouldAbort=!0),window.URL.revokeObjectURL(this.videoElement.src)}},{key:"reinitializeVideoElementSrc",value:function(){return this.metric("mediaSource.reinitialized",1),this.destroyVideoElementSrc(),this.getVideoElementSrc()}},{key:"isMediaSourceReady",value:function(){return this.mediaSource&&"open"===this.mediaSource.readyState}},{key:"isSourceBufferReady",value:function(){return this.sourceBuffer&&!1===this.sourceBuffer.updating}},{key:"initializeSourceBuffer",value:(e=regeneratorRuntime.mark(function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(l("initializeSourceBuffer..."),n=i()({},n,{onAppendStart:c.a,onAppendFinish:c.a,onRemoveFinish:c.a,onAppendError:c.a,onRemoveError:c.a,onStreamFrozen:c.a,onError:c.a,retry:!0}),this.isMediaSourceReady()){e.next=4;break}throw new Error("Cannot create the sourceBuffer if the mediaSource is not ready.");case 4:return e.next=6,this.destroySourceBuffer();case 6:this.metric("sourceBuffer.created",1),this.sourceBuffer=this.mediaSource.addSourceBuffer(t),this.sourceBuffer.mode="sequence",this.eventListeners.sourceBuffer.onAppendStart=n.onAppendStart,this.eventListeners.sourceBuffer.onAppendError=n.onAppendError,this.eventListeners.sourceBuffer.onRemoveFinish=n.onRemoveFinish,this.eventListeners.sourceBuffer.onAppendFinish=n.onAppendFinish,this.eventListeners.sourceBuffer.onRemoveError=n.onRemoveError,this.eventListeners.sourceBuffer.onStreamFrozen=n.onStreamFrozen,this.eventListeners.sourceBuffer.onError=n.onError,this.sourceBuffer.addEventListener("updateend",this.onSourceBufferUpdateEnd),this.sourceBuffer.addEventListener("error",this.eventListeners.sourceBuffer.onError);case 18:case"end":return e.stop()}},e,this)}),t=function(){var a=e.apply(this,arguments);return new Promise(function(s,i){return function t(e,n){try{var r=a[e](n),o=r.value}catch(e){return void i(e)}if(!r.done)return Promise.resolve(o).then(function(e){t("next",e)},function(e){t("throw",e)});s(o)}("next")})},function(e){return t.apply(this,arguments)})},{key:"queueSegment",value:function(e){this.segmentQueue.length?l("Queueing segment.  The queue currently has "+this.segmentQueue.length+" segments."):f("Queueing segment.  The queue is currently empty."),this.metric("queue.added",1),this.segmentQueue.push({timestamp:Date.now(),byteArray:e})}},{key:"sourceBufferAbort",value:function(){l("Aborting current sourceBuffer operation");try{this.metric("sourceBuffer.abort",1),this.sourceBuffer&&(this.sourceBuffer.abort(),this.shouldAbort=!1)}catch(e){this.metric("error.sourceBuffer.abort",1),this.eventListeners.sourceBuffer.onAbortError&&this.eventListeners.sourceBuffer.onAbortError(e)}}},{key:"_append",value:function(e){var t=e.timestamp,n=e.byteArray;f("Appending to the sourceBuffer...");try{var r=Date.now()-t;if(r>this.options.driftThreshold)return l("Estimated drift of "+r+" is above the "+this.options.driftThreshold+" threshold.  Flushing queue..."),this.metric("queue.removed",this.segmentQueue.length+1),void(this.segmentQueue=[]);f("Appending to the buffer with an estimated drift of "+r),this.metric("sourceBuffer.append",1),this.sourceBuffer.appendBuffer(n)}catch(e){this.metric("error.sourceBuffer.append",1),this.eventListeners.sourceBuffer.onAppendError(e,n)}}},{key:"processNextInQueue",value:function(){if(f("processNextInQueue"),!this.destroyed)return document.hidden?(l("Tab not in focus - dropping frame..."),this.metric("frameDrop.hiddenTab",1),void this.metric("queue.cannotProcessNext",1)):this.isMediaSourceReady()?this.isSourceBufferReady()?void(this.segmentQueue.length>0&&(this.metric("queue.shift",1),this.metric("queue.canProcessNext",1),this._append(this.segmentQueue.shift()))):(l("The sourceBuffer is busy"),this.metric("queue.sourceBufferNotReady",1),void this.metric("queue.cannotProcessNext",1)):(l("The mediaSource is not ready"),this.metric("queue.mediaSourceNotReady",1),void this.metric("queue.cannotProcessNext",1))}},{key:"formatMoof",value:function(e){return e[20]=(4278190080&this.sequenceNumber)>>24,e[21]=(16711680&this.sequenceNumber)>>16,e[22]=(65280&this.sequenceNumber)>>8,e[23]=255&this.sequenceNumber,e}},{key:"appendMoov",value:function(e){l("appendMoov"),e&&(this.metric("sourceBuffer.lastMoovSize",e.length),this.eventListeners.sourceBuffer.onAppendStart&&(l("appending moov..."),this.queueSegment(e),this.processNextInQueue()))}},{key:"append",value:function(e){f("Append"),this.destroyed||(this.metric("sourceBuffer.lastMoofSize",e.length),this.eventListeners.sourceBuffer.onAppendStart&&(this.eventListeners.sourceBuffer.onAppendStart(e),this.metric("queue.append",1),this.queueSegment(this.formatMoof(e)),this.sequenceNumber++,this.processNextInQueue()))}},{key:"getBufferTimes",value:function(){f("getBufferTimes...");try{var e=this.timeBuffered,t=this.sourceBuffer.buffered.start(0),n=this.sourceBuffer.buffered.end(0),r={previousBufferSize:e,currentBufferSize:n-t,bufferTimeStart:t,bufferTimeEnd:n};return f("getBufferTimes finished successfully..."),r}catch(e){return l("getBufferTimes finished unsuccessfully..."),null}}},{key:"trimBuffer",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getBufferTimes(),t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];f("trimBuffer..."),this.metric("sourceBuffer.lastKnownBufferSize",this.timeBuffered);try{if(e&&(t||this.timeBuffered>this.options.bufferSizeLimit)&&this.isSourceBufferReady()){l("Removing old stuff from sourceBuffer..."),this.metric("sourceBuffer.trim",this.options.bufferTruncateValue);var n=t?1/0:e.bufferTimeStart+this.options.bufferTruncateValue;l("trimming buffer..."),this.sourceBuffer.remove(e.bufferTimeStart,n),l("finished trimming buffer...")}}catch(e){l("trimBuffer failure!"),this.metric("sourceBuffer.trim.error",1),this.eventListeners.sourceBuffer.onRemoveError(e),console.error(e)}f("trimBuffer finished...")}},{key:"onRemoveFinish",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getBufferTimes();l("On remove finish..."),this.metric("sourceBuffer.updateEnd.removeEvent",1),this.eventListeners.sourceBuffer.onRemoveFinish(e)}},{key:"onAppendFinish",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getBufferTimes();if(f("On append finish..."),this.metric("sourceBuffer.updateEnd.appendEvent",1),this.previousTimeEnd&&e.bufferTimeEnd<=this.previousTimeEnd)return this.metric("sourceBuffer.updateEnd.bufferFrozen",1),void this.eventListeners.sourceBuffer.onStreamFrozen();this.previousTimeEnd=e.bufferTimeEnd,this.eventListeners.sourceBuffer.onAppendFinish(e),this.trimBuffer(e)}},{key:"destroySourceBuffer",value:function(){var r=this;return l("destroySourceBuffer..."),new Promise(function(t,e){var n=function e(){r.sourceBuffer&&r.sourceBuffer.removeEventListener("updateend",e),r.sourceBufferAbort(),l("destroySourceBuffer finished..."),t()};if(!r.sourceBuffer)return n();r.sourceBuffer.removeEventListener("updateend",r.onSourceBufferUpdateEnd),r.sourceBuffer.removeEventListener("error",r.eventListeners.sourceBuffer.onError),r.sourceBuffer.addEventListener("updateend",n),l("giving sourceBuffer some time to finish updating itself..."),setTimeout(n,1e3)})}},{key:"destroyMediaSource",value:function(){this.metric("sourceBuffer.destroyed",1),l("Destroying mediaSource..."),this.mediaSource&&(this.trimBuffer(void 0,!0),this.mediaSource.removeEventListener("sourceopen",this.eventListeners.mediaSource.sourceopen),this.mediaSource.removeEventListener("sourceended",this.eventListeners.mediaSource.sourceended),this.mediaSource.removeEventListener("error",this.eventListeners.mediaSource.error),this.isMediaSourceReady()&&this.isSourceBufferReady()&&(l("media source was ready for endOfStream and removeSourceBuffer"),this.mediaSource.endOfStream(),this.mediaSource.removeSourceBuffer(this.sourceBuffer)),this.destroyVideoElementSrc(),this.metric("mediaSource.destroyed",1))}},{key:"_freeAllResources",value:function(){l("_freeAllResources..."),this.mediaSource=null,this.sourceBuffer=null,this.videoElement=null,this.timeBuffered=null,this.previousTimeEnd=null,this.segmentQueue=null,this.options=null,this.metrics=null,this.events=null,this.eventListeners=null,l("_freeAllResources finished...")}},{key:"destroy",value:function(){var t=this;if(l("destroy..."),this.destroyed)return Promise.resolve();this.destroyed=!0,this.destroyMediaSource();var e=this.destroySourceBuffer().then(function(){l("destroySourceBuffer successfully finished..."),t._freeAllResources()}).catch(function(e){l("destroySourceBuffer failed..."),console.error("Error while destroying the source buffer!"),console.error(e),t._freeAllResources()});return l("destroy finished..."),e}}]),o}();h.EVENT_NAMES=["metric"],h.METRIC_TYPES=["mediaSource.created","mediaSource.destroyed","objectURL.created","objectURL.revoked","mediaSource.reinitialized","sourceBuffer.created","sourceBuffer.destroyed","queue.added","queue.removed","sourceBuffer.append","error.sourceBuffer.append","frameDrop.hiddenTab","queue.mediaSourceNotReady","queue.sourceBufferNotReady","queue.shift","queue.append","sourceBuffer.lastKnownBufferSize","sourceBuffer.trim","sourceBuffer.trim.error","sourceBuffer.updateEnd","sourceBuffer.updateEnd.bufferLength.empty","sourceBuffer.updateEnd.bufferLength.error","sourceBuffer.updateEnd.removeEvent","sourceBuffer.updateEnd.appendEvent","sourceBuffer.updateEnd.bufferFrozen","sourceBuffer.abort","error.sourceBuffer.abort","sourceBuffer.lastMoofSize"],t.default=h},"./src/js/iov/MqttTopicHandlers.js":function(e,t,n){"use strict";n.r(t);var r=n("./node_modules/debug/src/browser.js"),o=n.n(r),s=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();var i=function(){function n(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.id=e,this.debug=o()("skyline:clsp:iov:"+this.id+":MqttTopicHandlers"),this.debug("constructing..."),this.iov=t,this._handlers={}}return s(n,[{key:"get",value:function(e){return this.debug("getting...",e),this._handlers[e]}},{key:"register",value:function(e,t){var n=this;this.debug("register...",e),this._handlers[e]=function(){n.debug("executing handler...",e),t.apply(void 0,arguments)}}},{key:"unregister",value:function(e){this.debug("unregistering...",e),this.exists(e)&&delete this._handlers[e]}},{key:"exists",value:function(e){return this.debug("exists?",e),this._handlers.hasOwnProperty(e)}},{key:"msghandler",value:function(e){this.debug("msghandler...",e);var t=e.destinationName;if(this.exists(t))try{this.get(t)(e)}catch(e){this.iov.events.exception(t+" handler exception",e)}else this.debug("No handler for "+t+" - message dropped",e)}}]),n}();t.default=i},"./src/js/iov/player.js":function(e,t,n){"use strict";n.r(t);var r=n("./node_modules/debug/src/browser.js"),o=n.n(r),s=n("./node_modules/uuid/v4.js"),i=n.n(s),a=n("./node_modules/lodash/defaults.js"),c=n.n(a),u=n("./src/js/iov/MSEWrapper.js"),d="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();function f(e){return function(){var a=e.apply(this,arguments);return new Promise(function(s,i){return function t(e,n){try{var r=a[e](n),o=r.value}catch(e){return void i(e)}if(!r.done)return Promise.resolve(o).then(function(e){t("next",e)},function(e){t("throw",e)});s(o)}("next")})}}var h="skyline:clsp:iov",p=o()(h+":IOVPlayer"),m=o()("silly:"+h+":IOVPlayer"),g=function(){function s(e,t,n){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),this.onVisibilityChange=function(){var e=void 0;document.hidden?e=setTimeout(f(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.stop();case 2:case"end":return e.stop()}},e,r)})),1e3):(clearTimeout(e),r.play())},p("constructor"),this.metrics={},this.events={};for(var o=0;o<s.EVENT_NAMES.length;o++)this.events[s.EVENT_NAMES[o]]=[];this._id=i()(),this.iov=e,this.playerInstance=t,this.eid=this.playerInstance.el().firstChild.id,this.id=this.eid.replace("_html5_api",""),this.initializeVideoElement(),this.options=c()({},n,{segmentIntervalSampleSize:s.SEGMENT_INTERVAL_SAMPLE_SIZE,driftCorrectionConstant:s.DRIFT_CORRECTION_CONSTANT,enableMetrics:!1}),this.state="initializing",this.firstFrameShown=!1,this.stopped=!1,this.LogSourceBuffer=!1,this.LogSourceBufferTopic=null,this.latestSegmentReceived=null,this.segmentIntervalAverage=null,this.segmentInterval=null,this.segmentIntervals=[],this.mseWrapper=null,this.moovBox=null,this.guid=null,this.mimeCodec=null,document.addEventListener("visibilitychange",this.onVisibilityChange)}var e,t;return l(s,null,[{key:"factory",value:function(e,t){return new s(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:{})}}]),l(s,[{key:"on",value:function(e,t){if(p("Registering Listener for "+e+" event..."),!s.EVENT_NAMES.includes(e))throw new Error('"'+e+'" is not a valid event."');this.destroyed||this.events[e].push(t)}},{key:"trigger",value:function(e,t){if(["metric","videoReceived"].includes(e)?m("Triggering "+e+" event..."):p("Triggering "+e+" event..."),!this.destroyed){if(!s.EVENT_NAMES.includes(e))throw new Error('"'+e+'" is not a valid event."');for(var n=0;n<this.events[e].length;n++)this.events[e][n](t,this)}}},{key:"metric",value:function(e,t){if(this.options.enableMetrics&&s.METRIC_TYPES.includes(e)){switch(e){case"video.driftCorrection":this.metrics[e]||(this.metrics[e]=0),this.metrics[e]+=t;break;default:this.metrics[e]=t}this.trigger("metric",{type:e,value:this.metrics[e]})}}},{key:"_onError",value:function(e,t,n){console.warn(e,":",t),console.error(n)}},{key:"assertMimeCodecSupported",value:function(e){if(!u.default.isMimeCodecSupported(e)){this.state="unsupported-mime-codec";var t="Unsupported mime codec: "+e;throw this.videoPlayer.errors.extend({PLAYER_ERR_IOV:{headline:"Error Playing Stream",message:t}}),this.videoPlayer.error({code:"PLAYER_ERR_IOV"}),new Error(t)}}},{key:"initializeVideoElement",value:function(){var o=this;if(this.videoJsVideoElement=document.getElementById(this.eid),!this.videoJsVideoElement)throw new Error('Unable to find an element in the DOM with id "'+this.eid+'".');var s="clsp-video-"+this._id;this.videoElement=this.videoJsVideoElement.cloneNode(),this.videoElement.setAttribute("id",s),this.videoElement.classList.add("clsp-video"),this.videoElementParent=this.videoJsVideoElement.parentNode,this.on("firstFrameShown",function(){if(null!==o.videoElementParent)try{o.videoElementParent.insertBefore(o.videoElement,o.videoJsVideoElement);for(var e=o.videoElementParent.getElementsByTagName("video"),t=0;t<e.length;t++){var n=e[t],r=n.getAttribute("id");if(r!==o.eid&&r!==s){o.videoElementParent.removeChild(n),n.remove(),e=n=null;break}}}catch(e){console.error(e)}})}},{key:"reinitializeMseWrapper",value:(t=f(regeneratorRuntime.mark(function e(n){var r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mseWrapper)return e.next=3,this.mseWrapper.destroy();e.next=3;break;case 3:if(this.mseWrapper=u.default.factory(this.videoElement),this.mseWrapper.on("metric",function(e){var t=e.type,n=e.value;r.trigger("metric",{type:t,value:n})}),this.mseWrapper.initializeMediaSource({onSourceOpen:function(){var e=f(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return p("on mediaSource sourceopen"),e.next=3,r.mseWrapper.initializeSourceBuffer(n,{onAppendStart:function(e){if(m("On Append Start..."),!0===r.LogSourceBuffer&&null!==r.LogSourceBufferTopic){p("Recording "+parseInt(e.length)+" bytes of data.");var t=new window.Paho.MQTT.Message(e);t.destinationName=r.LogSourceBufferTopic,window.MQTTClient.send(t)}r.iov.statsMsg.byteCount+=e.length},onAppendFinish:function(e){if(m("On Append Finish..."),r.firstFrameShown||(r.firstFrameShown=!0,r.playerInstance.trigger("firstFrameShown"),r.trigger("firstFrameShown")),r.drift=e.bufferTimeEnd-r.videoElement.currentTime,r.metric("sourceBuffer.bufferTimeEnd",e.bufferTimeEnd),r.metric("video.currentTime",r.videoElement.currentTime),r.metric("video.drift",r.drift),r.drift>r.segmentIntervalAverage/1e3+r.options.driftCorrectionConstant&&(r.metric("video.driftCorrection",1),r.videoElement.currentTime=e.bufferTimeEnd),!0===r.videoElement.paused){p("Video is paused!");try{var t=r.videoElement.play();"undefined"!==typeof t&&t.catch(function(e){r._onError("videojs.play.promise","Error while trying to play videojs player",e)})}catch(e){r._onError("videojs.play.notPromise","Error while trying to play videojs player",e)}}},onRemoveFinish:function(e){p("onRemoveFinish")},onAppendError:function(){var t=f(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r._onError("sourceBuffer.append","Error while appending to sourceBuffer",t),e.next=3,r.reinitializeMseWrapper(n);case 3:case"end":return e.stop()}},e,r)}));return function(e){return t.apply(this,arguments)}}(),onRemoveError:function(e){"DOMException"!==e.constructor.name&&r._onError("sourceBuffer.remove","Error while removing segments from sourceBuffer",e)},onStreamFrozen:function(){var e=f(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return p("stream appears to be frozen - reinitializing..."),e.next=3,r.reinitializeMseWrapper(n);case 3:case"end":return e.stop()}},e,r)}));return function(){return e.apply(this,arguments)}}(),onError:function(){var t=f(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r._onError("mediaSource.sourceBuffer.generic","mediaSource sourceBuffer error",t),e.next=3,r.reinitializeMseWrapper(n);case 3:case"end":return e.stop()}},e,r)}));return function(e){return t.apply(this,arguments)}}()});case 3:r.trigger("videoInfoReceived"),r.mseWrapper.appendMoov(r.moovBox);case 5:case"end":return e.stop()}},e,r)}));return function(){return e.apply(this,arguments)}}(),onSourceEnded:function(){var e=f(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return p("on mediaSource sourceended"),e.next=3,r.stop();case 3:case"end":return e.stop()}},e,r)}));return function(){return e.apply(this,arguments)}}(),onError:function(e){r._onError("mediaSource.generic","mediaSource error",e)}}),this.mseWrapper.mediaSource&&this.videoElement){e.next=8;break}throw new Error("The video element or mediaSource is not ready!");case 8:this.mseWrapper.reinitializeVideoElementSrc();case 9:case"end":return e.stop()}},e,this)})),function(e){return t.apply(this,arguments)})},{key:"resyncStream",value:function(t){var n=this;p("Trying to resync stream..."),this.iov.conduit.subscribe("iov/video/"+this.guid+"/resync",f(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return p("sync received re-initialize media source buffer"),e.next=3,n.reinitializeMseWrapper(t);case 3:case"end":return e.stop()}},e,n)})))}},{key:"restart",value:(e=f(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return p("restart"),e.next=3,this.stop();case 3:this.play();case 4:case"end":return e.stop()}},e,this)})),function(){return e.apply(this,arguments)})},{key:"play",value:function(){var e=this;p("play"),this.stopped=!1,this.iov.conduit.transaction("iov/video/"+window.btoa(this.iov.config.streamName)+"/request",function(){return e.onIovPlayTransaction.apply(e,arguments)},{clientId:this.iov.config.clientId})}},{key:"stop",value:function(){var n=this;return p("stop..."),this.stopped=!0,this.moovBox=null,this.guid&&(this.iov.conduit.unsubscribe("iov/video/"+this.guid+"/live"),this.iov.conduit.unsubscribe("iov/video/"+this.guid+"/resync"),this.iov.conduit.publish("iov/video/"+this.guid+"/stop",{clientId:this.iov.config.clientId})),p("stop about to finish synchronously..."),new Promise(function(e,t){n.mseWrapper?n.mseWrapper.destroy().then(function(){n.mseWrapper=null,p("stop succeeded asynchronously..."),e()}).catch(function(e){n.mseWrapper=null,p("stop failed asynchronously..."),t(e)}):e()})}},{key:"getSegmentIntervalMetrics",value:function(){var e=this.latestSegmentReceived;if(this.latestSegmentReceived=Date.now(),e&&(this.segmentInterval=this.latestSegmentReceived-e),this.segmentInterval){this.segmentIntervals.length>=this.options.segmentIntervalSampleSize&&this.segmentIntervals.shift(),this.segmentIntervals.push(this.segmentInterval);for(var t=0,n=0;n<this.segmentIntervals.length;n++)t+=this.segmentIntervals[n];this.segmentIntervalAverage=t/this.segmentIntervals.length,this.metric("video.segmentInterval",this.segmentInterval),this.metric("video.segmentIntervalAverage",this.segmentIntervalAverage)}}},{key:"onIovPlayTransaction",value:function(e){var s=this,i=e.mimeCodec,a=e.guid;if(!this.stopped){p("onIovPlayTransaction"),this.assertMimeCodecSupported(i);var t,c=this.iov.config.clientId+"/init-segment/"+parseInt(1e6*Math.random());this.state="waiting-for-first-moov",this.iov.conduit.subscribe(c,(t=f(regeneratorRuntime.mark(function e(t){var n,r,o=t.payloadBytes;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s.stopped)return e.abrupt("return");e.next=2;break;case 2:return p("onIovPlayTransaction "+c+" listener fired"),p('received moov of type "'+("undefined"===typeof o?"undefined":d(o))+'" from server'),n=o,s.state="waiting-for-first-moof",s.iov.conduit.unsubscribe(c),r="iov/video/"+a+"/live",s.iov.conduit.subscribe(r,function(e){s.stopped||(s.trigger("videoReceived"),s.getSegmentIntervalMetrics(),s.mseWrapper.append(e.payloadBytes))}),s.guid=a,s.moovBox=n,s.mimeCodec=i,e.next=14,s.reinitializeMseWrapper(i);case 14:s.resyncStream(i);case 15:case"end":return e.stop()}},e,s)})),function(e){return t.apply(this,arguments)})),this.iov.conduit.publish("iov/video/"+a+"/play",{initSegmentTopic:c,clientId:this.iov.config.clientId})}}},{key:"_freeAllResources",value:function(){p("_freeAllResources..."),this.iov=null,this.state=null,this.firstFrameShown=null,this.playerInstance=null,this.videoJsVideoElement=null,this.videoElementParent=null,this.events=null,this.metrics=null,this.LogSourceBuffer=null,this.LogSourceBufferTopic=null,this.latestSegmentReceived=null,this.segmentIntervalAverage=null,this.segmentInterval=null,this.segmentIntervals=null,this.guid=null,this.moovBox=null,this.mimeCodec=null,p("_freeAllResources finished...")}},{key:"destroy",value:function(){var t=this;p("destroy..."),this.destroyed||(this.destroyed=!0,p("about to stop..."),this.stop().then(function(){p("stopped successfully..."),t._freeAllResources()}).catch(function(e){p("stopped unsuccessfully..."),console.error("Error while destroying the iov player!"),console.error(e),t._freeAllResources()}),p("disconnecting from server..."),this.iov.conduit.disconnect(),document.removeEventListener("visibilitychange",this.onVisibilityChange),this.videoElement.src="",this.videoElement=null,p("destroy finished..."))}}]),s}();g.EVENT_NAMES=["metric","firstFrameShown","videoReceived","videoInfoReceived"],g.METRIC_TYPES=["sourceBuffer.bufferTimeEnd","video.currentTime","video.drift","video.driftCorrection","video.segmentInterval","video.segmentIntervalAverage"],g.SEGMENT_INTERVAL_SAMPLE_SIZE=5,g.DRIFT_CORRECTION_CONSTANT=2,t.default=g},"./src/js/utils.js":function(e,t,n){"use strict";n.r(t);var r=n("./package.json");t.default={version:r.version,name:"clsp",supported:function(){if(!Boolean(window.chrome)||!Boolean(window.chrome.webstore))return!1;if(window.MediaSource=window.MediaSource||window.WebKitMediaSource,!window.MediaSource)return console.error("Media Source Extensions not supported in your browser: Claris Live Streaming will not work!"),!1;try{return parseInt(navigator.userAgent.match(/Chrom(e|ium)\/([0-9]+)\./)[2],10)>=52}catch(e){return console.error(e),!1}},isSupportedMimeType:function(e){return"video/mp4; codecs='avc1.42E01E'"===e}}},"./src/js/videojs-mse-over-clsp.js":function(e,t,n){"use strict";n.r(t);n("./node_modules/srcdoc-polyfill/srcdoc-polyfill.js"),n("./src/js/conduit/clspConduit.generated.js");var r=n("./src/js/MseOverMqttPlugin.js"),o=(n("./src/styles/videojs-mse-over-clsp.scss"),Object(r.default)());o.register(),t.default=o},"./src/styles/videojs-mse-over-clsp.scss":function(e,t){},0:function(e,t,n){e.exports=n("./src/js/videojs-mse-over-clsp.js")},"video.js":function(e,t){e.exports=videojs}});